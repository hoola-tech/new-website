{"componentChunkName":"component---src-components-blog-blog-template-js","path":"/blog/using-aws-lambda-to-create-a-mongodb-connection-proxy-2bb53c4a0af4","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (-1 !== e.indexOf(n)) continue; t[n] = r[n]; } return t; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"slug\": \"blog/using-aws-lambda-to-create-a-mongodb-connection-proxy-2bb53c4a0af4\",\n  \"title\": \"Using AWS Lambda to Create a MongoDB Connection Proxy\",\n  \"description\": \"How weâ€™ve used AWS Lambda to create a MongoDB connection proxy.\",\n  \"tags\": [\"Serverless\", \"MongoDB\", \"Database\", \"AWS\", \"Lambda\"],\n  \"featureImage\": \"./assets/using-aws-lambda-to-create-a-mongodb-connection-proxy-2bb53c4a0af4/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png\",\n  \"author\": \"adrian\",\n  \"date\": \"2020-02-17T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Serverless definitely brings a lot of awesome stuff to the table, but unfortunately, as we\\u2019re still in the early days more or less, there are still some rough edges that need to be taken care of.\"), mdx(\"p\", null, \"In our \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/blog/webiny-january-update-%EF%B8%8F-a7b8dc7fcb36\"\n  }, \"latest Hoola AI release\"), \", we attempted to tackle one of these rough edges and that is the database connection management, which can be non-trivial when dealing with FaaS, or in our case, with Lambda functions.\"), mdx(\"p\", null, \"Don\\u2019t know what I\\u2019m talking about? Let\\u2019s briefly examine the problem.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"490px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/2505c260f0e6cc0311aae5e6695ab9d2/6b254/max-980-0ZbZFvMHF12vkMOso.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"64%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDAf/EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAFdoxQLg//EABkQAAMAAwAAAAAAAAAAAAAAAAABAhEhMv/aAAgBAQABBQLIm2yOZLjf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAABAhAf/aAAgBAQAGPwJ6SL//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhYTFB/9oACAEBAAE/IW62t/IhglzhekUng6uMGVpyqn//2gAMAwEAAgADAAAAELwv/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EK2P/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERMf/aAAgBAgEBPxBZCM//xAAcEAADAQACAwAAAAAAAAAAAAABESEAMUFRYXH/2gAIAQEAAT8QCuUwFG8P3ogonNxPzxxTJ31pIwLr6MAcjQLu7//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 980 0ZbZFvMHF12vkMOso\",\n    \"title\": \"max 980 0ZbZFvMHF12vkMOso\",\n    \"src\": \"/static/2505c260f0e6cc0311aae5e6695ab9d2/6b254/max-980-0ZbZFvMHF12vkMOso.jpg\",\n    \"srcSet\": [\"/static/2505c260f0e6cc0311aae5e6695ab9d2/e07e9/max-980-0ZbZFvMHF12vkMOso.jpg 200w\", \"/static/2505c260f0e6cc0311aae5e6695ab9d2/066f9/max-980-0ZbZFvMHF12vkMOso.jpg 400w\", \"/static/2505c260f0e6cc0311aae5e6695ab9d2/6b254/max-980-0ZbZFvMHF12vkMOso.jpg 490w\"],\n    \"sizes\": \"(max-width: 490px) 100vw, 490px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h2\", {\n    \"id\": \"the-problem\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The Problem\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#the-problem\",\n    \"aria-label\": \"the problem permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"For those who might not be familiar with the problem of database connection management in a serverless environment, let\\u2019s explain it briefly.\"), mdx(\"p\", null, \"With Lambda functions (or any FaaS in general), unfortunately, things can get a little tricky when you have a function that works with a \\u201Ctraditional\\u201D database, like for example MySQL or MongoDB.\"), mdx(\"p\", null, \"Basically, every time a Lambda function is invoked for the first time (or a new function instance is created because of a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-features.html\"\n  }, \"concurrent invocation\"), \"), we need to establish a new connection to our database. While there is nothing wrong with that, the problem arises when we have to close it.\"), mdx(\"p\", null, \"As some of you may know, after a period of inactivity, Lambda functions get destroyed and when that happens, the database connection, unfortunately, doesn\\u2019t get closed, and basically enters the \\u201Czombie\\u201D mode. In other words, the connection is still there, but no one is using it.\"), mdx(\"p\", null, \"And over time, as this scenario repeats, the number of these \\u201Czombie\\u201D connections may significantly rise, to the point that you can reach the limit for maximum established connections defined on your database server. Because the database can basically become inaccessible at that point, this can obviously create serious problems for your app.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/5ab3d56367d3fdb8b2c869be6671728b/35252/max-2408-1aL1re993W0v63k1ocVwhEQ.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"76.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADi0lEQVQ4y5WSf0yUdRzH3/fcL+6eu+OOu4PozhRO7wdHFx0UFP3CO/Pg5AKiB8FWeCaigYdLDba0dG2t0K3NOQdbc7OWLVu5smnGr8dM7DjBNhSEA3rIIMpVsrTZnfu0u7E2t2Lztb32/ev7+u7z2Rf4D+KaTBD0IGQhrrnHeC1/qXveYrIRjCkEE+LqbMRYO2Ks499zUW6nZoAgB8HOxNQqw3iLe/9UMKeMAMWP5Q+KY6xzIbYQVDmSJtm8kk/aWPIN6F0gEnRh5sklIChAUDO/pZuMX/ld9qFHbGaCXn1DmyuPqexpMdYui7N2EIC1gR5466Pwb/0ZcOMYsvABqhw9uLlTjtEGKy63rsDvbnNiZObvVJ1+LOj0TZdn5xBYBUEHUjskt1UObYy1qwhaZHxCQMFVLOFuAC58LDXjiKza2cvMb5eJhjdaxVc2ZIsHdlkZwjLRTa3WMLK14K3x+tzVBMgFk1P7i86pndPnpvyldclJYZG3Vx1jYJ2SGsuuSbGjsv9CW8350VDpuTVEhKeyLIaizJTUpuI0BeWYmD/05nQDIL2Ie9VkSNe8d/TtxJiSOPSqr3WrlHiH8FggUsI1jQ3X7JgZxGt1YdobjFCL/1zDwGcEvy0n3bNUqdvzhIFN7PgWJNKpTQ+snq5dsTxCBrwYPanw0Igyn64qfV9+pwAID3v61tY2fk81zVHCtkBf6yuVfXtbyvodFkBSbs00llrYtHZPhnpbngyFz0N0ufXxkeGdj24gL4M9XQfYuvFu5bqxLlV1uFeZeDSv+JTl6Yqe3b7agVexsWAYdaZZNHvDCHkHEVp5HYFlLKqip1H55yiCk99KfNFT5jWTPRrPr/2onj4j5gReywm8pmaWl3BD3Sl5y0/AYI/CVvIT0Fh0iXkha07U5AmLQt5LaCg+CV82C2H9fZgsRPJbTITc+6NbnCWUCTRfOKrmBF7CCTzD/cDLa6+fEdnwBcwPCcz9pXMMOjs777CjoyMZ7H3Tj+NtxXi9/Rnx4O5VH0Z2eQIzm50AETiBl3ECr+cEXsQJPCpmz+LwwUPJ+/+Llgj5RHj21iQDIimIxAwRKmbOJ2IGbppPhO9wUWjB1LPdmCiEet6KRFRUN9GleE64y1iCKy87cbEUOA2IxrYXDY225NeTC5jY4hTfdSxBx0dt2PfpG9gUfl9y4kD9us8PrnceP/QSuvZxosVi/wAinntzM7OLJQAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2408 1aL1re993W0v63k1ocVwhEQ\",\n    \"title\": \"max 2408 1aL1re993W0v63k1ocVwhEQ\",\n    \"src\": \"/static/5ab3d56367d3fdb8b2c869be6671728b/5a190/max-2408-1aL1re993W0v63k1ocVwhEQ.png\",\n    \"srcSet\": [\"/static/5ab3d56367d3fdb8b2c869be6671728b/772e8/max-2408-1aL1re993W0v63k1ocVwhEQ.png 200w\", \"/static/5ab3d56367d3fdb8b2c869be6671728b/e17e5/max-2408-1aL1re993W0v63k1ocVwhEQ.png 400w\", \"/static/5ab3d56367d3fdb8b2c869be6671728b/5a190/max-2408-1aL1re993W0v63k1ocVwhEQ.png 800w\", \"/static/5ab3d56367d3fdb8b2c869be6671728b/c1b63/max-2408-1aL1re993W0v63k1ocVwhEQ.png 1200w\", \"/static/5ab3d56367d3fdb8b2c869be6671728b/35252/max-2408-1aL1re993W0v63k1ocVwhEQ.png 1204w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The above diagram shows multiple instances of a single Lambda function. But in a real-life, there will be more than one Lambda function in the mix, and that\\u2019s when it gets even more worrying.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/eaa0b7b53b438ccf6c33c363b3d115af/35252/max-2408-10f8PBX6oWZm5ZKNF9LxQ2Q.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"77.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADvklEQVQ4y5WUbUxbZRTH/723pff29mWUt1GYo7cto4gC7kU2XgXKm1RENgEhynQMbAGB4bZEmdtwGy7ZJvtigtE537CzEaIYGRtsrKuj9N5SmNmYU4lmXxYXM7+4uMQ85raKWVww/pOTc76cX3L+zzkPcB+drUvE8bWAAaAubUu5c9mR5gr02TD9Qg7lhwkiw4eDlXJSqF5Wp505oUzIXczuLDz2zaul/YQQBDUWrciZdGHQX8ClMIWb28s8tLPEK0MBwRFbOgZssfi452m8d/UuPhn3ykmYLHtb8CnGnnFA4MycyPIxIsur5hUGjBpsqNgyQ9lfXKTtnTdptBZMoa3Ei81vELSsTUZzug6v5a3ER/lAPUB5m8yn5lvWtHk+r4I/zqIJqJNokeEpkTGqA0wSeyLleZmtfh6lzYuwd98CWvLP1ziKLvLIIzhY+BB7+LEY5cjmRFYaMTRmxzrftZ6N7puubgQNaSpRxetFho8UWJPao8tQEoAuaFh4pHjr9zWVXT/bsa/JT3qqpncMHSd4MtWaUMpz0T1Z0XqAYM/EDTqTkIj+EV/U4Mm3Ii5YN2EOKyXP5D5ujXoiPk+DHwmKa4NuR+8isbffIOht8EnAjpGDBI+uTo2xRCp0jWk6jSZSjwP1ufRkI9/u3WrOm3YDgiZJL7K8FCt8qmTNmdhsNX4iyC2/8GFDa5CUPnf1N3Rv+TK7o3xaXxYJeaUlKrLCxGl3Zek14bcgCDgzb1/bseHsD0NdCG7MVQT0RslDpcDyukvqFJYA1IbC04m2qi+ybbUzaXCUTMJZPI1qHVCTEofqZDV2WoE9M3fw7Pht+sybuzIn+ltz+065ldfBRAicOUryUGSMigBjVF5UpynK1n0Aa/Yk8p8Sga4npqjOCj8KOKDCHI0ynkNfiRGfdtoxfKCNdtea09+ttUYFU8cokV3F+dUWSlSF9lArsDzt0T6Mx3NcssJqL1VUNy/D4ODgPSHpXF089j0QKmVCy4O/LnRkjF45WgsfgNmY1ZTI8HHS2H8v93XQOHH4yFL/v/RVV2nIP3LuZYi7bdvnXilr/uOlSlyOtspFFR8rsrxi6fwYIwTp/Nhlzm+/9xcMe4L4zDWkIKnSAgGuo68r5xDLzaywyv+BhYHLwiSN10TDXaHFoXjIJupXbfu6MSFr8PdN8Ky3UAJjxj3A/4JJOl9nQDcbrmedGbe+7V4/9t2x7VgY3iu7kpPw/2CS3h84hPRJghQvoSb7moqm9jeW735nVN570oWhgb1LP8z99CelQmiWa96CTAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2408 10f8PBX6oWZm5ZKNF9LxQ2Q\",\n    \"title\": \"max 2408 10f8PBX6oWZm5ZKNF9LxQ2Q\",\n    \"src\": \"/static/eaa0b7b53b438ccf6c33c363b3d115af/5a190/max-2408-10f8PBX6oWZm5ZKNF9LxQ2Q.png\",\n    \"srcSet\": [\"/static/eaa0b7b53b438ccf6c33c363b3d115af/772e8/max-2408-10f8PBX6oWZm5ZKNF9LxQ2Q.png 200w\", \"/static/eaa0b7b53b438ccf6c33c363b3d115af/e17e5/max-2408-10f8PBX6oWZm5ZKNF9LxQ2Q.png 400w\", \"/static/eaa0b7b53b438ccf6c33c363b3d115af/5a190/max-2408-10f8PBX6oWZm5ZKNF9LxQ2Q.png 800w\", \"/static/eaa0b7b53b438ccf6c33c363b3d115af/c1b63/max-2408-10f8PBX6oWZm5ZKNF9LxQ2Q.png 1200w\", \"/static/eaa0b7b53b438ccf6c33c363b3d115af/35252/max-2408-10f8PBX6oWZm5ZKNF9LxQ2Q.png 1204w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h2\", {\n    \"id\": \"any-known-solutions\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Any Known Solutions?\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#any-known-solutions\",\n    \"aria-label\": \"any known solutions permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Although there are a few solutions for some databases today, like e.g. AWS Serverless Aurora\\u2019s \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/data-api.html\"\n  }, \"Data API\"), \", or recently announced \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://aws.amazon.com/rds/proxy/\"\n  }, \"RDS Proxy\"), \" for AWS\\u2019s relational databases, the managed MongoDB hosting service that we are currently mostly relying on, the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.mongodb.com/cloud/atlas\"\n  }, \"MongoDB Atlas\"), \", doesn\\u2019t offer a similar solution. They do list some best practices in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.atlas.mongodb.com/best-practices-connecting-to-aws-lambda/\"\n  }, \"this article\"), \", but it\\u2019s an old article, and it doesn\\u2019t really solve the problem.\"), mdx(\"p\", null, \"We even tried the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://aws.amazon.com/documentdb/\"\n  }, \"Amazon DocumentDB (with MongoDB compatibility)\"), \", but because of several reasons, like the fact that you have to put your function into a VPC, and that there is no free tier, we, unfortunately, had to discard it. And most importantly, the same problem exists here too.\"), mdx(\"p\", null, \"Once we\\u2019ve realized that there isn\\u2019t a proper solution on an infrastructure level, we\\u2019ve decided to check if there\\u2019s something we can do in our code.\"), mdx(\"p\", null, \"In the past, while we were still using MySQL, we were relying on this package called \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/jeremydaly/serverless-mysql\"\n  }, \"severless-mysql\"), \", by the great \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.jeremydaly.com/\"\n  }, \"Jeremy Daly\"), \", which would basically, behind the scenes, do the connection management for you on function invocations. So naturally, we asked ourselves, is there something similar, but for MongoDB?\"), mdx(\"p\", null, \"The answer is, unfortunately, no. But hey, no problem, this sounds like an interesting problem to tackle, and it would be a useful tool for other developers. Let\\u2019s try to do it ourselves.\"), mdx(\"p\", null, \"We basically wanted to use the same basic idea that the mentioned MySQL package had. On function invocation, behind the scenes, get a list of all inactive connections and destroy them. But, here\\u2019s the deal-breaker.\"), mdx(\"p\", null, \"While this is possible to accomplish in the MySQL world via queries like \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/jeremydaly/serverless-mysql/blob/master/index.js#L269\"\n  }, \"these\"), \", unfortunately, the MongoDB Node.js client doesn\\u2019t offer similar commands. Yes, there is the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"db.serverStatus().connections\"), \" command, but other than giving you info about the current status of connections, it doesn\\u2019t help you much.\"), mdx(\"p\", null, \"So, unfortunately, the time has come to move on to the last idea we had up our sleeves.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"500px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/edfc1156807fc5838888b185cbafe78d/0b533/max-1000-0CGhaZ5wfrs_Mgp2b.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"80%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD20lEQVQozwHQAy/8AHx6amF3S2eIVX2gZam7itrYz93XwcHIrNbOwMrFq620iqSfeJGVeIyJbXh/VoyYeLC2m5+liJSke6a3lQB/dmNWYTxYZER+i121pW3EvJjVvIvVy6TZv5C7p2a5rnnBp3GVkWasmG6Cg1ytpXzAwpy7xqKYqIaBlHQAg4dlWmovi3RJmY9crZ1mtax7x8Sau7yLqad5opxujJNmm51qp6RkoZdlrKN0za18ur+awtG9xMjDrLSuAKinnbbBqJiVdKCVaJOedq2zmrnEsLbMtaa7oau1n4+lhnCDTH+IVYOLY7y8qt7TycnWzdDc0tLg0szcygDx8/r2+fq8zZ2VuF+iwm/KyJKx0XO5wIm8uYuysomzwIWgylWdv1aex2Kn0nOv2X+l0GWcy2CYyF+SxFQAmspZj8M/i8Uukssxlso7nc45tM5rqmRAuH1UupR7tZmOsMhzmNU7lM9DlNA7mcw2ms84j8wyisUwiMMuAGalB2moCW6rEW6sEm+vEX65JKyUZZVUOKSBZ6CHfWo4MGNWP6TKR5zDPZjAOovALYG6HYC2G3OzDm+wDgC1wqS2w6S5xqm6yKq7yae+w6eieWJ9PCKKV0lyIBN8IAycbVHg18Hg1cW8sICgqFSUqFGRqkl5ojlumTUAzcTNzcbP087U19Ta4OHq0cXCi19KjEsqdCcPdRsMgC4VtIFg5N/g5uHl2dbExLeY1svH0MzJycHAyMHEAMa5uczAvtHKx9XT0drFxbCMhIFUS3BNQForG3w7JaBXLcOLYtbNxsCpo8GkoMKsn7Wimcq/wca6vbutrwCooa1/gZuTk6mclKRiQkqFXWeFVllpU1JrR0GWXlHdci7hczC3USyWQCy3e1nbonTKrJaupau5qKmyo6QAVFh5WGCGa1ZgVzU2Z1pjUEFKWCcik0A2m0U3llJBmCgY2Twu3007tE4xwI51tHxhrHBZuJaZpJCPqZyiAE1SdmVnc3pqZWQ/OoN9fXhmYHlRT3E3NoVsaWxRS2Q+PZxjXZFoY3VST21kZ3dub29fYYI+JbGdoI1+iQBYVm9bSEhqTUZqQzdtU0heUlBaTEpSOTVrUk9eT05RQT9wVFGMTUKKVEZpPjeATEGPWUx7RzebjZClm64AVkpWPS84GwAAMgYBJwUAHAgHIwYELAUAPwoBTCYgLhoZLwMAfx0ImTseei4WeSEHhhoAnj8isYJwlnh9AMzLzMrJycfJycbIyczLy9PQ0NHPzs/Lyt3Tz+TY1dnR0c7NzdLPzeTb1ebc1ODVz9vTztrRzNjLxdrV1XAvBKiUCv/MAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 1000 0CGhaZ5wfrs Mgp2b\",\n    \"title\": \"max 1000 0CGhaZ5wfrs Mgp2b\",\n    \"src\": \"/static/edfc1156807fc5838888b185cbafe78d/0b533/max-1000-0CGhaZ5wfrs_Mgp2b.png\",\n    \"srcSet\": [\"/static/edfc1156807fc5838888b185cbafe78d/772e8/max-1000-0CGhaZ5wfrs_Mgp2b.png 200w\", \"/static/edfc1156807fc5838888b185cbafe78d/e17e5/max-1000-0CGhaZ5wfrs_Mgp2b.png 400w\", \"/static/edfc1156807fc5838888b185cbafe78d/0b533/max-1000-0CGhaZ5wfrs_Mgp2b.png 500w\"],\n    \"sizes\": \"(max-width: 500px) 100vw, 500px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h2\", {\n    \"id\": \"introducing-db-proxy-lambda-function\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Introducing DB Proxy Lambda Function\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#introducing-db-proxy-lambda-function\",\n    \"aria-label\": \"introducing db proxy lambda function permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"So, as we couldn\\u2019t find an adequate solution to this problem, we decided to try to create a solution of our own.\"), mdx(\"p\", null, \"Enter \\u201C\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"DB Proxy\\u201D Lambda function \\u2014 \"), \"a Lambda function that serves as a database connection proxy (as you can probably tell by its name). In other words, every function that needs to talk to the database, won\\u2019t actually establish its own database connection anymore, but will invoke the mentioned DB Proxy Lambda function whenever a database query needs to be made, with all of the query params sent via the invocation payload. Once invoked, the DB Proxy Lambda function will run the query using the standard \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.mongodb.com/ecosystem/drivers/node/\"\n  }, \"MongoDB Node.js driver\"), \", and finally, respond back with the query results.\"), mdx(\"p\", null, \"The following diagram basically shows how it all works together:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/7a23575266fdaad35d98ed1bea9acea9/2a333/max-2968-1hisT6WR3JaUuhz0bbAFmzA.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"62%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADOklEQVQoz3VSe0xTdxT+fpd7KXAvt+AAH6zcFXEwBlIRfAHysOVpKY8KWGdkKBa1ZAbNVBQkOAXHP8vCcCH7R//QiFkckcxoJbHgEmAmS4A5sDQdQjAhZInGB4p4TAXjHtmXnJzkO/m+c3LOAf6FlyHLQAAIgvd09sep0+naBAK8PNy8/3LMieGLdTUI/iDImA8MfW+wL8MBa3ovLpVUwmUNwkxM6KIAwr1KXdlIeayBAAYiEM5hTopgBHAEiSOoQFAwo05EcrkbefsngYyATiSJXejdk4+H1Rq0UQZmg4JACPQb1keuup+iDSOoVQQJFc3AKzHYfyYlfOPjaI2W4MMRwkHLEqAqegbdzr+AGFz01uKy4KjYwob3aLih0o+8Otz5nim8nFZd5VhFrMkzHcgNQhyb85PUo7b4mvFtnyQQQtXPgz6V6cM1AtJmeaVgRoWjJX3u2rIB+864emlrOKTPY5YG1O5aylOwRuyAJA1AFEmSfUdMmZ41sBdLQtUXwPk9hr/8KkBRUbAv34Rcqbjqj86yQxPjqN3eN3tix8BvxdGH5PgQLNFrA0O+NSq+dxu3wPXFumqnLd5MJT5o/fGEYJh7ICQNf8+7ahKPDR3ZGAsiYTf1yDhll0yW/jvmqnsvUJXzk2LN6lpu1ERxaYq3T94q2edCvsIP1qTA3mIu6P66OHmqMgot15r5tpYCNG4Gu3PaWN3z1dbI0S/Xwzp4VbS4HUJS8uUQQ0FXGHZv/hnlm+wwRyUiLUyAXhFB0z9g9HgaBo8kZQ/WJK5/bRRw9loTbxm9zm9/MsKTWcbzvRGw/t4pF03+Ipa6exCnu4oNhltAdW43s2U72GcxmcjS8jiYrmCsVs+c9Zn4tSHr8N16femjcgXfXanzXknEDnwA5jq4tmHo8Abd4nth06VbSM2zM8O2Pob29vZ/hOeiU627MH8smb0VcAsiD5/91MlbBs4LvWdMex2njRHXv9mBm2eLWMm4A+/iP3holnH/ZA4bO5qKP22ri1z7olNpBXD89jmVxXmDK3z74AtNKGUh/6+ZB11njJioMzBnnQH9jTkH+huyCh/YVmPKGslZxm7C9HdDvDd8hzeLzkCcw5yItAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2968 1hisT6WR3JaUuhz0bbAFmzA\",\n    \"title\": \"max 2968 1hisT6WR3JaUuhz0bbAFmzA\",\n    \"src\": \"/static/7a23575266fdaad35d98ed1bea9acea9/5a190/max-2968-1hisT6WR3JaUuhz0bbAFmzA.png\",\n    \"srcSet\": [\"/static/7a23575266fdaad35d98ed1bea9acea9/772e8/max-2968-1hisT6WR3JaUuhz0bbAFmzA.png 200w\", \"/static/7a23575266fdaad35d98ed1bea9acea9/e17e5/max-2968-1hisT6WR3JaUuhz0bbAFmzA.png 400w\", \"/static/7a23575266fdaad35d98ed1bea9acea9/5a190/max-2968-1hisT6WR3JaUuhz0bbAFmzA.png 800w\", \"/static/7a23575266fdaad35d98ed1bea9acea9/c1b63/max-2968-1hisT6WR3JaUuhz0bbAFmzA.png 1200w\", \"/static/7a23575266fdaad35d98ed1bea9acea9/2a333/max-2968-1hisT6WR3JaUuhz0bbAFmzA.png 1484w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"One thing to note here is that, as you might have noticed, zombie connections will still exist, because, at some point in time, DB Proxy Lambda function instances will still get destroyed, thus the same problem repeating. We are aware of that, but our goal is not to make the number of these zombie connections go to zero, but to try to make this number as small as possible.\"), mdx(\"p\", null, \"First, we decided to see how all of this performs in terms of speed, because if it turns out that invoking another function to do a simple database query is slow, then there\\u2019s no point in further exploration of this idea, wouldn\\u2019t you agree?\"), mdx(\"h2\", {\n    \"id\": \"performance\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Performance\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#performance\",\n    \"aria-label\": \"performance permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"When this idea came up, our immediate concern was that by invoking another Lambda function to execute database queries (instead of doing it like we always did, using the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.mongodb.com/ecosystem/drivers/node/\"\n  }, \"MongoDB Node.js driver\"), \"), we would introduce significant latencies and thus negatively impact the overall performance.\"), mdx(\"p\", null, \"But as it turned out, it\\u2019s not bad at all! Yes, there is the additional latency if we are hitting a function cold start and in that case, function initialization and a new database connection establishment, but other than that, for our needs, we\\u2019ve considered the performance to be in the acceptable range.\"), mdx(\"p\", null, \"Let\\u2019s check it out!\"), mdx(\"h3\", {\n    \"id\": \"testing-results\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Testing Results\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#testing-results\",\n    \"aria-label\": \"testing results permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"As mentioned, every time one of your functions needs to talk to the database and a new DB Proxy Lambda function instance needs to be created, you will have an increased initial latency, due to:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"the cold start\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"function initialization\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"establishment of a new database connection\")), mdx(\"p\", null, \"And this is what the following \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/lambda/latest/dg/lambda-x-ray.html\"\n  }, \"X-Ray trace\"), \" shows:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/57725c16336395aace696900ae68c511/22284/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"27%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA20lEQVQY0z3NS0/DMBAE4Pz/P4XEiQhV9FgO9IVEba+9jR0/mt14FzVCfJrrzAwAYK313jvnrLUAzjlARB/Q+xAQQwjgwx9E8GGaprgZUkrGGADIOedSe2c7P95P4e0Ydmf8uOD+guMJd2fcX3E8hm+sqtq7iMiQczbGpJSYOcaU2lyYVbVxx7zEsuRGh1t6/XTjF7wc3HUri6iqDkQUYxR9Ls25zC3PCxUSrHyvBJmmSmZ+mNRuqf3Edq+sKtuxDL33belJN7xKoV6oc5fGQl2WtdMqlYXWZ/79AqtpG/dQRATbAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 4856 1iF2wNL3FvXRnx5L7fhHmfA\",\n    \"title\": \"max 4856 1iF2wNL3FvXRnx5L7fhHmfA\",\n    \"src\": \"/static/57725c16336395aace696900ae68c511/5a190/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png\",\n    \"srcSet\": [\"/static/57725c16336395aace696900ae68c511/772e8/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png 200w\", \"/static/57725c16336395aace696900ae68c511/e17e5/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png 400w\", \"/static/57725c16336395aace696900ae68c511/5a190/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png 800w\", \"/static/57725c16336395aace696900ae68c511/c1b63/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png 1200w\", \"/static/57725c16336395aace696900ae68c511/29007/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png 1600w\", \"/static/57725c16336395aace696900ae68c511/22284/max-4856-1iF2wNL3FvXRnx5L7fhHmfA.png 2428w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"As we can see, we first have a 185ms long cold start, followed by a 294ms initialization process. This is actually the execution of the code that is located outside of the exported handler function, which happens only on this initial invocation. Finally, we have a 302ms of actual handler execution, in which we probably have ~280ms or more waisted due to the new database connection establishment.\"), mdx(\"p\", null, \"Now, if we take a look at the X-Ray trace of the next invocation, we\\u2019ll see that, performance-wise, the breakdown looks very different.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/9b5e6438336c851fd9bbc09880f3c1d7/78415/max-2414-1qvUkvcnX5O9yvo7CtvhdpA.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"20.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAu0lEQVQI1z3LwU7DMAyA4b7/G8FtBw5IE7uUakJMZRpoaRbbS5ysaZy4CND4Dv/t74wxiAgA0x045wk8QiC4IhC4n6JDcIGQEBCRfnXWWmOMtdZ7H5hLmT8u4fnd7kb3Ml62o+tPOHxif8LdEbYH+wWsrZYiItIR0d9ZSokx5ZpDrnQTnmVe6nAOD73Z7KfHV/N0AH8rWdp616WUmFlVa60hxphjWGQW9UuTpueQ3yYeDO8nHiGtq6q2f9/ByN/p7Tg0lwAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2414 1qvUkvcnX5O9yvo7CtvhdpA\",\n    \"title\": \"max 2414 1qvUkvcnX5O9yvo7CtvhdpA\",\n    \"src\": \"/static/9b5e6438336c851fd9bbc09880f3c1d7/5a190/max-2414-1qvUkvcnX5O9yvo7CtvhdpA.png\",\n    \"srcSet\": [\"/static/9b5e6438336c851fd9bbc09880f3c1d7/772e8/max-2414-1qvUkvcnX5O9yvo7CtvhdpA.png 200w\", \"/static/9b5e6438336c851fd9bbc09880f3c1d7/e17e5/max-2414-1qvUkvcnX5O9yvo7CtvhdpA.png 400w\", \"/static/9b5e6438336c851fd9bbc09880f3c1d7/5a190/max-2414-1qvUkvcnX5O9yvo7CtvhdpA.png 800w\", \"/static/9b5e6438336c851fd9bbc09880f3c1d7/c1b63/max-2414-1qvUkvcnX5O9yvo7CtvhdpA.png 1200w\", \"/static/9b5e6438336c851fd9bbc09880f3c1d7/78415/max-2414-1qvUkvcnX5O9yvo7CtvhdpA.png 1207w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"So first, we have the initial 4.5ms, which is something that\\u2019s out of our control. This is the time it took the AWS Lambda service to execute the function invocation request.\"), mdx(\"p\", null, \"But after that, there is no initialization step we\\u2019ve seen in the previous diagram. We\\u2019ve immediately jumped to the invocation, which this time lasted for 4.2ms, which is the actual database query execution. Finally, with the overhead, we are looking at a total of 11ms.\"), mdx(\"p\", null, \"Okay, I admit, maybe the second graph shows a cherry-picked invocation that looks more appealing in terms of the speed performance, but the complete picture also looks fine. Because these measurements tend to be variable, I pulled out the following graph that shows 30 invocations:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/5dd9b3b12d60e90ba1588d862fe4199f/5e17e/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"59.00000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQoz6WRwW7EIAxE+f9fXakbAgYbe+wVySqie2mb+vTE4BkbEjO3Rr13d48/VjIzVXN3AP6LWq8lRYhOmyv5FFb4UC9IAHh8S8ZRK3yoF6SIEJ1ud5Ld/X6zqnb5x9hz5dsPtibHmxBxnvyU3Ifj6FKL+eUxOwzT3TClM2mZ603H2Oq1exN8FTwrtmaZLBOILTffO1h8MqEyMlntIEZpliJ8qG1kOykPUwWLlqZqeGyy5b003cmeRRpb7Zbr4DEtZOgLYKfHUvjY4fUAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 5336 1KeYRHfZ06zoQlnOM0AdRbg\",\n    \"title\": \"max 5336 1KeYRHfZ06zoQlnOM0AdRbg\",\n    \"src\": \"/static/5dd9b3b12d60e90ba1588d862fe4199f/5a190/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png\",\n    \"srcSet\": [\"/static/5dd9b3b12d60e90ba1588d862fe4199f/772e8/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png 200w\", \"/static/5dd9b3b12d60e90ba1588d862fe4199f/e17e5/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png 400w\", \"/static/5dd9b3b12d60e90ba1588d862fe4199f/5a190/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png 800w\", \"/static/5dd9b3b12d60e90ba1588d862fe4199f/c1b63/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png 1200w\", \"/static/5dd9b3b12d60e90ba1588d862fe4199f/29007/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png 1600w\", \"/static/5dd9b3b12d60e90ba1588d862fe4199f/5e17e/max-5336-1KeYRHfZ06zoQlnOM0AdRbg.png 2668w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Except for the initial cold-start invocation, we can see that most of the time we are dealing with latencies that are in the 10\\u201320ms range. If we would calculate the average, excluding the initial 706ms, we would get 27.24ms.\"), mdx(\"p\", null, \"27.24ms on average for a single database query? Is that fast enough? Well, it depends on your particular use case. For our platform, we\\u2019ve considered it to be in the acceptable range.\"), mdx(\"p\", null, \"As for the initial 706ms, if that\\u2019s something that\\u2019s bothering you, there is this thing called \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://aws.amazon.com/blogs/aws/new-provisioned-concurrency-for-lambda-functions/\"\n  }, \"provisioned concurrency for Lambda functions\"), \", which basically removes cold starts by keeping your function initialized at all times:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u2026a feature that keeps functions initialized and hyper-ready to respond in double-digit milliseconds. This is ideal for implementing interactive services, such as web and mobile backends, latency-sensitive microservices, or synchronous APIs.\")), mdx(\"p\", null, \"\\u2026a feature that keeps functions initialized and hyper-ready to respond in double-digit milliseconds. This is ideal for implementing interactive services, such as web and mobile backends, latency-sensitive microservices, or synchronous APIs.\"), mdx(\"p\", null, \"Have in mind that it\\u2019s not free, so if you\\u2019ll be thinking about this, make sure to test it out first and determine if it\\u2019s really worth it.\"), mdx(\"p\", null, \"To conclude, with these performance testing results, we decided to continue with the implementation and see what effect will it have on the problem we were trying to solve.\"), mdx(\"h2\", {\n    \"id\": \"database-connections\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Database Connections\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#database-connections\",\n    \"aria-label\": \"database connections permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"So, after some testing, by checking the MongoDB Atlas dashboard, we\\u2019ve noticed that the total number of established database connections really did decrease.\"), mdx(\"p\", null, \"A good example is the Hoola AI installation process. Every time you deploy a brand new Hoola AI system, the apps you\\u2019ve included (e.g. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.hoola.ai/serverless-app/page-builder/\"\n  }, \"Page Builder\"), \" or \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.hoola.ai/serverless-app/form-builder\"\n  }, \"Form Builder\"), \") must be installed. And in that process, several Lambda functions are invoked in a very short time interval, possibly multiple times.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/9588a43b3b3d39992a7cac04184fc4ad/29114/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"73.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVQoz32SO2+dMBSA+f9ju2Ztx2ar1ClTpkqdKiXpkPD2AwP28QuwsasLXOIbqf1kATLn8zk+dlbRRjJGOyZAKm24gNe8zitUVCivUFnjuqVlTYqmq1pS53VVobqlRdG0uMs88Ekp1g+YEEIpoR1ljA0D6wfW9yPnSuuRi5bpy+IEA8VKaUbwPE1ZxGW02nkvpVQbUkrY2F4i+QZQCra/UikhRIY7JpVelkWIa5yUOkGmwMEenD0/PQGA9/6UrbVCiHEDANYE7z0kZEqpEEKaeZomY4xSCgC01jFhXdcb2fkL8zynmcuyRAgJITjnw5W+7/ddvMvzNDvnPshkYy9ba3120Vp7I3MpJ2vnpGxrLUKIUooxppRSgvuOAh/FOFhjbuS3IkcIaa3PKWttvdE0TVVVzcCJWUYXBheMXxMXsteX56Ztz7QA4Jw7+hPC5fnyKz7ch8fv4eF+Lf5IY+EanLVtK6Xcj+fstttZFheiefyhvnxS3+7U18/m909pJxD8kJdliTGmR7XfgQPOYV4gRlgjhAgX8z0s2wv8IN/AOfDxGNec+0XMwrax/8nwrzX5XybsTsQb6Fj3AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 3840 1Q3xm39FhA5l1xmSjGpl5sw\",\n    \"title\": \"max 3840 1Q3xm39FhA5l1xmSjGpl5sw\",\n    \"src\": \"/static/9588a43b3b3d39992a7cac04184fc4ad/5a190/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png\",\n    \"srcSet\": [\"/static/9588a43b3b3d39992a7cac04184fc4ad/772e8/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png 200w\", \"/static/9588a43b3b3d39992a7cac04184fc4ad/e17e5/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png 400w\", \"/static/9588a43b3b3d39992a7cac04184fc4ad/5a190/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png 800w\", \"/static/9588a43b3b3d39992a7cac04184fc4ad/c1b63/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png 1200w\", \"/static/9588a43b3b3d39992a7cac04184fc4ad/29007/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png 1600w\", \"/static/9588a43b3b3d39992a7cac04184fc4ad/29114/max-3840-1Q3xm39FhA5l1xmSjGpl5sw.png 1920w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"As shown, before the DB Proxy Lambda function, every function instantiation would establish a new database connection. So if you were installing let\\u2019s say 4 apps, and for each app, we had two Lambda function invocations, that would translate to 4\\u20138 new database connections, depending on how fast the invocations were made and thus the creation of new function instances.\"), mdx(\"p\", null, \"With the DB Proxy Lambda function, instead of the mentioned 4\\u20138 connections, we now have 2\\u20134 connections, which is definitely a significant reduction.\"), mdx(\"p\", null, \"This is just one specific case, but a similar reduction happened in the overall number of connections. Before, by just doing simple content management via the admin UI, over the course of 15\\u201320 minutes, we would reach 30\\u201340 connections, which was very surprising to us. Now, this number is contained in the 15\\u201330 range, which we considered a good drop.\"), mdx(\"h2\", {\n    \"id\": \"more-benefits\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"More Benefits\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#more-benefits\",\n    \"aria-label\": \"more benefits permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"So, with the shown performance and database connection management testing results, we\\u2019ve considered this whole experiment to be successful, and that\\u2019s why we\\u2019ve decided to keep this solution, so our users can utilize it and make their apps more reliable.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/6826594f2015b8c8e00d2a04090f1f98/066f9/max-800-0uq_9Dic7G__46qJF.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"100%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAEF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB3edGG0cUGaICqkM//8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAERIDE//aAAgBAQABBQKPV3NlY5GdT0YRuz25LH//xAAXEQADAQAAAAAAAAAAAAAAAAAAEBEx/9oACAEDAQE/AdI//8QAFxEBAAMAAAAAAAAAAAAAAAAAEAERMf/aAAgBAgEBPwGdKP/EABoQAAIDAQEAAAAAAAAAAAAAAAARARAxIVH/2gAIAQEABj8CJrRvvlaaOT//xAAaEAADAQEBAQAAAAAAAAAAAAAAAREhMVHB/9oACAEBAAE/IRs+u9uDK4HM0mhHjFFOOYQvlFG1n//aAAwDAQACAAMAAAAQ5DeA/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEREP/aAAgBAwEBPxCpCd//xAAYEQEBAAMAAAAAAAAAAAAAAAABABARUf/aAAgBAgEBPxBaBhHIv//EAB8QAQEAAgEEAwAAAAAAAAAAAAERACFRMUFxgZGh8P/aAAgBAQABPxDFM0GJ6nfUwR0UyPCcW/WS3VaKM5zXsPWGGIZoYfGDIIJP0ZReYWBo8Z//2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 800 0uq 9Dic7G  46qJF\",\n    \"title\": \"max 800 0uq 9Dic7G  46qJF\",\n    \"src\": \"/static/6826594f2015b8c8e00d2a04090f1f98/066f9/max-800-0uq_9Dic7G__46qJF.jpg\",\n    \"srcSet\": [\"/static/6826594f2015b8c8e00d2a04090f1f98/e07e9/max-800-0uq_9Dic7G__46qJF.jpg 200w\", \"/static/6826594f2015b8c8e00d2a04090f1f98/066f9/max-800-0uq_9Dic7G__46qJF.jpg 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"But that\\u2019s not all actually. This approach added even more benefits than just the database connection management problem we\\u2019ve initially set to solve. Let\\u2019s check it out!\"), mdx(\"h3\", {\n    \"id\": \"maximum-number-of-connections-can-be-defined\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Maximum Number of Connections Can Be Defined\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#maximum-number-of-connections-can-be-defined\",\n    \"aria-label\": \"maximum number of connections can be defined permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Since connections are now established only from the DB Proxy Lambda function, by utilizing the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://aws.amazon.com/about-aws/whats-new/2017/11/set-concurrency-limits-on-individual-aws-lambda-functions/\"\n  }, \"reserved concurrency\"), \" (which lets us define the maximum number of concurrent function instances), we now have the ability to control the maximum number of connections that can be established.\"), mdx(\"p\", null, \"For example, if we were to set the reserved concurrency to 100, this means we can have up to 100 concurrent DB Proxy Lambda function instances, which in other words means we can have up to 100 active connections at the same time. Pretty cool right?\"), mdx(\"p\", null, \"In every Hoola AI installation, by default, we\\u2019ve set the reserved concurrency to 15, but you can adjust it to your needs, via your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/api/serverless.yml\"), \" file, via the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"concurrencyLimit\"), \" param:\"), mdx(\"deckgo-highlight-code\", {\n    \"highlight-lines\": \"undefined\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"dbProxy:\\n  component: \\\"@webiny/serverless-db-proxy\\\"\\n  inputs:\\n    concurrencyLimit: 15\\n    env:\\n      MONGODB_SERVER: ${vars.mongodb.server}\\n      MONGODB_NAME: ${vars.mongodb.name}\"), \"\\n        \"), mdx(\"p\", null, \"But still, as mentioned, do note that the DB Proxy Lambda function instances will be destroyed at some point in time, which will again leave zombie connections behind. So the actual number of total open connections to the database server may be a bit higher than the one set as the function\\u2019s reserved concurrency.\"), mdx(\"p\", null, \"Also, except for the fact that the DB Proxy Lambda function instances are destroyed due to inactivity, they are also destroyed upon deployments. For example, if you had 100 active DB Proxy Lambda function instances, redeploying the function would destroy all of these instances, and depending on the actual traffic, create 100 new ones. This means 100 new connection establishment requests! So make sure to have that on your mind if the DB Proxy Lambda function redeployment is necessary.\"), mdx(\"p\", null, \"This also brings me to my next point\\u2026\"), mdx(\"h3\", {\n    \"id\": \"redeployments-dont-create-new-connections\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Redeployments Don\\u2019t Create New Connections\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#redeployments-dont-create-new-connections\",\n    \"aria-label\": \"redeployments dont create new connections permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Occasionally, we might need to deploy several services, which might be comprised of several functions. If we were to deploy 20 new functions, and if all of them were talking to the database, that would basically mean we\\u2019ll get 20 zombie connections after the deployment has finished (assuming we have only one instance of each function), and establish 20 new ones. Things get even worse if you had to repeat the deployment once or twice.\"), mdx(\"p\", null, \"With this approach, this problem basically disappears, because, unless we have to make some changes to the DB Proxy Lambda function, we don\\u2019t usually need to deploy it again, which means the same already established connections will be reused by the redeployed functions.\"), mdx(\"h3\", {\n    \"id\": \"smaller-functions\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Smaller Functions\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#smaller-functions\",\n    \"aria-label\": \"smaller functions permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Previously, all functions that needed to talk to the database had to include the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"mongodb\"), \" package, which is actually 1.18MB in size. If you had a function that\\u2019s 5MB in size, that would actually represent 23.6% of the function\\u2019s total size! Massive percentage if you ask me.\"), mdx(\"p\", null, \"Since functions don\\u2019t need to include the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"mongodb\"), \" package anymore (it\\u2019s only included in the DB Proxy Lambda function, which is basically its only dependency), all functions are now lighter in total bundle size, which is also a cool benefit.\"), mdx(\"h2\", {\n    \"id\": \"increase-of-lambda-function-invocations\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Increase of Lambda Function Invocations?\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#increase-of-lambda-function-invocations\",\n    \"aria-label\": \"increase of lambda function invocations permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Before I wrap this up, I just wanted to quickly cover one more thing.\"), mdx(\"p\", null, \"You might be asking yourself:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Wait, isn\\u2019t this approach going to increase the total amount of Lambda function invocations? Can this impact my monthly costs?\")), mdx(\"p\", null, \"Wait, isn\\u2019t this approach going to increase the total amount of Lambda function invocations? Can this impact my monthly costs?\"), mdx(\"p\", null, \"Yes, that\\u2019s true, and unfortunately, there is no way around it. Every database query is a new Lambda function invocation. That\\u2019s why, if you will be implementing something like this, try to estimate how many invocations you might have, and how it might affect your monthly cost.\"), mdx(\"p\", null, \"The cool thing about the DB Proxy Lambda function is that it doesn\\u2019t require a lot of system resources. In fact, you should be just fine with a minimum of 128MB of RAM. And since every invocation should last less than 100ms, the first one million invocations are going to be \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://aws.amazon.com/lambda/pricing/\"\n  }, \"free\"), \" (if we\\u2019re not including the invocations of other Lambda functions that you might have).\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"The AWS Lambda free usage tier includes 1M free requests per month and 400,000 GB-seconds of compute time per month.\")), mdx(\"p\", null, \"The AWS Lambda free usage tier includes 1M free requests per month and 400,000 GB-seconds of compute time per month.\"), mdx(\"p\", null, \"Also, if you have functions that are doing several database queries in a single invocation, if possible, try to fetch all of the needed data in one invocation. Not only this will generate fewer function invocations, but will also be faster.\"), mdx(\"p\", null, \"All in all, this is definitely something to be mindful of, but for now, we didn\\u2019t find it to be a deal-breaker.\"), mdx(\"h2\", {\n    \"id\": \"conclusion\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Conclusion\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#conclusion\",\n    \"aria-label\": \"conclusion permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"As seen, once we\\u2019ve implemented the shown DB Proxy Lambda function solution, we\\u2019ve noticed a significant reduction in the number of zombie connections. And not only that, but we\\u2019ve also gained some really nice features and optimizations along the way. The following pros and cons basically summarize everything we\\u2019ve talked about:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/06d362ca7b61d85a8f8ee011be4687e5/cf4cc/max-2158-1JmdqcjduINke0jipKtoy3g.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"60%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABx0lEQVQoz52SXS9jYRDH/z0tS7ZWSxVVQteNC+IruNjjQsKXeK73a0hcurdJr0nEhmI5iViviQsS2zZa1ai+qJfEYtMVnZFndySHRIlJ/jnPy8xv5pkzwFOrBlAPwA3A0Ae3hYiTrtdBV5aiv1mTSimc5uKG+H8QX/czDhzyDQAYATAMoFEfbEZGXVSMgPJTiv4cmXwTQ3hi3Cn+vQCGRDV4i/HlssHZJVB6RtF12rw73wczOyrFBERB27pF9m3fRr9W3cbmcB+fUXxz8oWZ0eD1dNpi2gF47C9tBtBhAzltl8bP8JiL4hbKe98V/879A3rqP3VLTJeoWdSmA3U2H4Aq+Sm10o9HMEo7P1DenlV8+R/o9/l0cr9AXM+frC9CooBk7JQKmrqDAT8XEuC1eUX548FSMqp7WLHvTQILSsntUvFHPUJ9oS4vJ6Lg5QVF2YzJqSQK0V9GJaAG9EhFIalQr+sAeD+3tvp5dR00t6joOGPSQRJ0WqwIfGxmUEAdMoO6hzUDvf1utrZQnl5SlD4xKXYIyp8Zr42bw6Ynznrm7qdWUA4vKEpkTNpNgjJFA++13KTlpI0YyNpTlLswKVUAnV29CHwA4gS7Z+Ryb2YAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2158 1JmdqcjduINke0jipKtoy3g\",\n    \"title\": \"max 2158 1JmdqcjduINke0jipKtoy3g\",\n    \"src\": \"/static/06d362ca7b61d85a8f8ee011be4687e5/5a190/max-2158-1JmdqcjduINke0jipKtoy3g.png\",\n    \"srcSet\": [\"/static/06d362ca7b61d85a8f8ee011be4687e5/772e8/max-2158-1JmdqcjduINke0jipKtoy3g.png 200w\", \"/static/06d362ca7b61d85a8f8ee011be4687e5/e17e5/max-2158-1JmdqcjduINke0jipKtoy3g.png 400w\", \"/static/06d362ca7b61d85a8f8ee011be4687e5/5a190/max-2158-1JmdqcjduINke0jipKtoy3g.png 800w\", \"/static/06d362ca7b61d85a8f8ee011be4687e5/cf4cc/max-2158-1JmdqcjduINke0jipKtoy3g.png 1079w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"If you ask me, I think it would be super cool to see a more \\u201Cofficial\\u201D solution to the database connection management problem from the MongoDB Atlas team, like for example something similar to the Data API that the AWS Serverless Aurora offers. I feel it\\u2019s kind of a shame that something like that still doesn\\u2019t exist, but I do hope they will come up with something in the near future. \\uD83E\\uDD1E\"), mdx(\"p\", null, \"We are aware that there are other serverless-first databases out there that don\\u2019t suffer from this problem. For example, the awesome DynamoDB (in fact, there\\u2019s \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/webiny/webiny-js/issues/662\"\n  }, \"an open issue already\"), \") or maybe even \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://fauna.com/\"\n  }, \"FaunaDB\"), \" (not tried it yet, but heard good things). But for now, we\\u2019ve decided to rely on MongoDB as the go-to database, due to its popularity, and the fact that it can be used with every major cloud provider (it\\u2019s not a cloud-native database).\"), mdx(\"p\", null, \"We will definitely keep a close eye on this issue, and keep monitoring the serverless space for new solutions that eventually may come up. And because listening to our community is one of our top priorities, if there\\u2019ll be more interest/demand, I can definitely see some changes happening in this segment.\"), mdx(\"p\", null, \"I hope I\\u2019ve managed to convey some of our experiences, and that you\\u2019ve received some value out of this article. If you have any additional questions or just wanna share your thoughts, we all at Hoola AI would definitely like to hear them!\"), mdx(\"hr\", null), mdx(\"p\", null, \"Thanks for reading! My name is Adrian and I work as a full-stack developer at \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.hoola.ai/\"\n  }, \"Hoola AI\"), \". In my spare time, I like to write about my / our experiences with some of the modern frontend and backend (serverless) web development tools, hoping it might help other developers in their everyday work. If you have any questions, comments or just wanna say hi, feel free to reach out to me via \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.twitter.com/doitadrian\"\n  }, \"Twitter\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"author":"adrian","slug":"blog/using-aws-lambda-to-create-a-mongodb-connection-proxy-2bb53c4a0af4","title":"Using AWS Lambda to Create a MongoDB Connection Proxy","description":"How weâ€™ve used AWS Lambda to create a MongoDB connection proxy.","tags":["Serverless","MongoDB","Database","AWS","Lambda"],"date":"February 17, 2020","featureImage":{"publicURL":"/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png","childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7UlEQVQozyWTW1MTBwBG95fVGRWQQHZz2w1hKQmbTcImxCQUEhAkKhJJx1gJCLE4Y522TqtQLVaUpjYBTcBcIBeMtUM7+kuOU/pwXr85D98RPHoJWd1FcRWQna+Q5TwDSh67ZRtr/zMsfb8imTYQzY9xKFv0mx/Q3bNG14UsXRcynOv9mvOmFGd6knzRM4MQDJYZGnmD7CridBVQnK9QB4sMDhRwOvIoth1k63Ns0lOczt+wK0/oM39Hv7iOSbxDlynDeVOaM91XOds7hxAOlzGMEqrnNa6hXQbVArpeIRJpMxY6IuCroWsH+PUSPr3IsPslDucmA+oGbu8mZusq3X03OWdKcbb3KsLFyAGxaJmbmTapdIuFVIOFVIf1e59YXf2H+Wsd0qkO2aX33Mq0WVpqcu36PonpPBOJF0xOPWFqZoOZ5Aa90g2EaOwt0eg+c7NVJuNVQuF9JuItpmc+cOXKey5NHxOfaBK7WCcSfks0UmJ8fA8jtMPQ8CP8xiMG1HUcAyuYxDRCJFZh9nKdpdstsktt5hea5O6esJr7yMqdjywufuD6fIfbt/4ifeP41HJxsc5iusJscpf41HMSl7aYTT5FcS0jjE/UiI1XMEL7uLUSHq3MaLBOwKhiBBv4fE38vkN0rYrmPkDzlPBqRTQtz/DINhbLfczSt1jldfqkbxBik4cEwjXc/goj/gp6oILmr+EPNvAH6qytnbCc/ZeJr1rMzbSJhGt4tdd4vQU82g6y/COi+S5mKYfZkkUIRBt4jCNGjEP04CH6aJXRsSaBUBNj7B3LKydkMn+TSLRJXm4zHT9C87zBqxXweH7HYX+IKN5DFHNI0gqCL3KMHm6hBY/Q/2O0ht+oobpLDA7tIStFHPY//v+k9SWKtI1ieYZd3MQm/oRV+gFJvH9qKVlyCP5Yh9PRsSZ6qIHXqOMzanw5Usal7qEO7eJy/Xlaj6rs4LK/wCFuYe3/BZv4MzbpIaL5AVbb9wwOP+YztFkqh5/uZvEAAAAASUVORK5CYII=","aspectRatio":1.9047619047619047,"src":"/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/ee604/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png","srcSet":"/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/69585/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png 200w,\n/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/497c6/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png 400w,\n/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/ee604/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png 800w,\n/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/f3583/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png 1200w,\n/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/5707d/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png 1600w,\n/static/4bc5028aa84c8d4b3c03b3a67fb3e09b/0ef64/max-4800-1DRs_MFApsc_P04Cj_9s9QA.png 2400w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"blog/using-aws-lambda-to-create-a-mongodb-connection-proxy-2bb53c4a0af4"}},"staticQueryHashes":["144257237"]}