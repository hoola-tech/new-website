{"componentChunkName":"component---src-components-blog-blog-template-js","path":"/blog/serverless-side-rendering-e1c0924b8da1","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (-1 !== e.indexOf(n)) continue; t[n] = r[n]; } return t; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"slug\": \"blog/serverless-side-rendering-e1c0924b8da1\",\n  \"title\": \"Serverless Side Rendering — The Ultimate Guide\",\n  \"description\": \"Learn how we’ve achieved great SEO support for every Hoola AI website and made them run super-fast, using SSR in a serverless environment.\",\n  \"tags\": [\"Serverless\", \"Single Page Applications\", \"AWS\", \"SEO\", \"CMS\"],\n  \"featureImage\": \"./assets/serverless-side-rendering-e1c0924b8da1/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png\",\n  \"author\": \"adrian\",\n  \"date\": \"2020-02-05T00:00:00.000Z\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"tldr\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"TLDR\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#tldr\",\n    \"aria-label\": \"tldr permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"I do realize this turned out to be a very long article and trust me, that wasn\\u2019t the intention. As I do understand some of you might not have the time to read it in its entirety, here\\u2019s a short TLDR I prepared:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"single page applications (SPAs) are cool but unfortunately, have bad SEO support\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"learn about different approaches of rendering on the web by checking out \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://developers.google.com/web/updates/2019/02/rendering-on-the-web\"\n  }, \"this Google article\"), \", and choose the approach that works best for your use case\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"for the Hoola AI Page Builder app, we decided to try \\u201CPrerendering on-demand\\u201D (using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"chrome-aws-lambda\"), \") and \\u201CSSR with (re)hydration\\u201D\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"implementing both of these approaches in the AWS cloud can be achieved with just a couple of serverless services \\u2014 S3, Lambda, API Gateway, and CloudFront\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"prerendering on-demand works and it\\u2019s a good approach if the initial loading screen (shown while the app is initializing) is not an issue in terms of UX, and SEO is your only concern, otherwise use SSR with (re)hydration\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"allocate more RAM (1600MB+ ) to the Lambda function that will actually be doing the pre-rendering, and a minimum amount of RAM to the one that will be just serving static files (128MB or 256MB)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"although we didn\\u2019t try it, you would probably need to implement some form of caching of the prerendered content, so that you get a better SEO results by returning the initial HTML faster\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"when implementing SSR with (re)hydration, allocate more RAM to the Lambda function that will actually be generating the SSR HTML\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"in general, SSR is a resource-intensive task, which will prevent you from serving your website fast enough, so you will most likely need to implement some kind of caching\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"we used CloudFront CDN to cache SSR HTML and depending on the app you\\u2019re building, choose between short and long-lived cache TTLs\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"if going with the latter, know that you will need to do cache invalidation which can get tricky very quickly\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"do cache-invalidation selectively, or in other words, if possible, invalidate cache only for pages that actually require it \\u2014 this may save you significant amount money along the way (cache invalidation requests are charged by CloudFront)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"if the content is changing very frequently, use shorter TTLs because it\\u2019s more effective\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"the good news is that, with \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.hoola.ai/\"\n  }, \"Hoola AI\"), \", this is all handled and maintained for you, feel free to check us out if this sounds interesting \\uD83D\\uDE80 \\uD83D\\uDE42\")), mdx(\"p\", null, \"So, this was the TLDR, but still, if you want to dive deeper into the topic, or maybe you just want to check out the serverless approaches and implementations we\\u2019ve tried, I encourage you to continue reading.\"), mdx(\"hr\", null), mdx(\"h2\", {\n    \"id\": \"serverless-side-rendering\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Serverless Side Rendering\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#serverless-side-rendering\",\n    \"aria-label\": \"serverless side rendering permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Here at \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.hoola.ai/\"\n  }, \"Hoola AI\"), \", we\\u2019re on a mission to create a platform that empowers developers to build serverless apps. In other words, we want to provide developers with proper tools and processes, in order to make the development using serverless technologies easier, more efficient and enjoyable. On top of that, we also want to build an eco-system of plugins and even ready-made apps, which will additionally cut development time and cost.\"), mdx(\"p\", null, \"Regarding the apps, out of the box, Hoola AI actually offers a couple of base apps that developers can utilize, one of which is our Page Builder app. I won\\u2019t bother you much with it, nor is this a promotional article, but I will feel free to say that we\\u2019ve worked on it for quite some time now (and will remain to do so). And while there were a lot of challenges we faced along the way, definitely one of the more interesting ones was serving pages to users in the best possible way. In other words, serving pages as fast as possible, and of course, with excellent support for search engine optimization (SEO).\"), mdx(\"p\", null, \"To achieve this, not only did we want to utilize the serverless technologies (duuuh \\uD83D\\uDE43), but also the modern single-page application (SPA) approach for building web sites and apps. But as it turned out, it can be pretty tricky to achieve and use all of the mentioned at the same time.\"), mdx(\"p\", null, \"SPAs are cool, but they have one serious disadvantage - bad SEO support, which comes from the fact that they are completely client-side rendered. This means we cannot completely rely on the client-side rendering (CSR) to render our app \\u2014 some form of server-side rendering (SSR) must be implemented too. But how do we do that? Even more importantly, how do we do something that was \\u201Ctraditionally\\u201D done with servers, in a serverless environment? How do we achieve \\u201Cserverless-side rendering\\u201D?\"), mdx(\"p\", null, \"I may have tossed a lot of information straight at the beginning of this article, but these are the things you\\u2019ll definitely need to examine if you want to have a modern, fast, scalable, and SEO-optimized single page application, which is what we wanted to provide for our users.\"), mdx(\"p\", null, \"In this article, I wanted to go over a few of the approaches we\\u2019ve tried to implement and show you what was the solution that in the end worked best for us. You will see that there isn\\u2019t a silver bullet solution and that the one you choose will depend on the app you\\u2019re building, and the requests and conditions that are in front of you.\"), mdx(\"p\", null, \"Since there are a lot of moving parts, and in order to get the full picture, I decided to take a step back and start from the beginning.\"), mdx(\"p\", null, \"First, let\\u2019s say a few words about single-page applications!\"), mdx(\"h2\", {\n    \"id\": \"before-we-begin\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Before We Begin\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#before-we-begin\",\n    \"aria-label\": \"before we begin permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"As mentioned, we will start off by saying a few words about single-page applications. We will cover their main features, advantages/disadvantages, and in general, we will also talk a bit about different rendering approaches on the web. If you came here for strictly serverless stuff, or you already have enough experience working with SPAs, feel free to jump to the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"What to choose?\"), \" section, in which we will explain which rendering approaches we decided to try, and then how we\\u2019ve implemented them in a serverless environment.\"), mdx(\"p\", null, \"Although we do plan to explore other cloud providers, at Hoola AI, we are currently working mostly with AWS, so the implementations you\\u2019re about to see will be specific to it. But if you\\u2019re not using AWS, I still think you should be able to follow this article and build everything in your cloud, using similar services.\"), mdx(\"h2\", {\n    \"id\": \"single-page-applications\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Single Page Applications\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#single-page-applications\",\n    \"aria-label\": \"single page applications permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"If you are a web developer, I\\u2019m pretty sure you\\u2019re familiar with the concept of single-page applications (SPAs). But let\\u2019s quickly go over a few of its main features and advantages.\"), mdx(\"h3\", {\n    \"id\": \"client-side-rendering-csr\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Client-side Rendering (CSR)\"), mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#client-side-rendering-csr\",\n    \"aria-label\": \"client side rendering csr permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"The main feature of every SPA is client-side rendering (CSR). This means that all of the UI (HTML) is generated inside the user\\u2019s browser, and not on some sort of backend (servers, containers, functions, whatever\\u2026 \\xAF\", \"_\", \"(\\u30C4)\", \"_\", \"/\\xAF). The coolest thing about this is that there are no page refreshes, meaning when you navigate to a different place in your app, only a portion of the page gets re-rendered, without the full page refresh. This generally produces a much better UX.\"), mdx(\"h3\", {\n    \"id\": \"cleaner-code\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Cleaner code\"), mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#cleaner-code\",\n    \"aria-label\": \"cleaner code permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"If you\\u2019ve ever worked with PHP, especially in the old days, you\\u2019ll probably remember those long Smarty / Twig template files, containing HTML, CSS, JS, maybe a couple of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"if\"), \" statements, probably a call or two to the database, and who knows what else. One big mess if you ask me. \\uD83E\\uDD2F\"), mdx(\"p\", null, \"With SPAs, the overall app code gets cleaner. This time we have two separate codebases, one that represents the actual SPA, and the other that represents the backend or the API, to which the app connects.\"), mdx(\"h3\", {\n    \"id\": \"easy-to-serve\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"strong\", {\n    parentName: \"h3\"\n  }, \"Easy to serve\"), mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#easy-to-serve\",\n    \"aria-label\": \"easy to serve permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"SPAs are easy to serve, especially in serverless environments. Once you\\u2019ve created a production build of your app, the only thing that\\u2019s basically left to do is upload it to a static file storage of your choice, for example, the Amazon S3. And if you want your app and static assets to be served super-fast, introducing a CDN to your backend architecture is also a relatively easy step to execute. That being said, if your app is relying on an API, note that the app will be as fast as is your API. If it\\u2019s slow, the SPA will also be slow, despite it being served super fast.\"), mdx(\"h2\", {\n    \"id\": \"drawbacks\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Drawbacks?\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#drawbacks\",\n    \"aria-label\": \"drawbacks permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"As seen, SPAs do possess some really nice features. But of course, the approach has its own drawbacks. I\\u2019m about to explain the biggest one in the following few sentences.\"), mdx(\"p\", null, \"Whenever you\\u2019re creating a public-facing website (SPA or non-SPA), you\\u2019d obviously expect to have link previews. In other words, when you share a link that points to your website on the internet, eg. social media site like Facebook, you\\u2019d expect to get a preview like this one:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"558px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/0b79c21d45b4c0e9afd59823246d8fb0/42a8d/max-1116-1a_C2daF2jugjC8f2OhF1ng.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"67%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACJElEQVQoz2WRyW7bMBCG9cztG/QhknO3Qw5OgfSQLmiWJo6RpllsWauXyFYkWaL2neSQLOQoadD+IIiZ4Xycn6AkXsiz7pfjsaUolmGubHfthWs3WD14q9WDNVsuFc13XEphd+ft61dvPh98l/6inE9vJ6cno/Ozy7Pj4dFg/8fHD0eDwcnht/OzX8Ofl6fHF5PrsaBECPH+3eDT/hfpBcsF533CgBu/6d0pM6/x8IAD6etAGcFCiKZuUBBJzyhDDmsqxoXnbFzXd1HyECSOHyI/mC+sjY8YF6wuWej1k4ToYQ4AlsrLTAhRFEUcxVVZ5lmWpWlVN0mwqQK3aytSsM3eHOPS49guCV1e5UKIuq4RQnEcR1EUhmEcxygIyjztGuuSIrd/JH+ExRYus3b0VZRpQ6jneb7ve55n2zYKkO/7RYt5FrYXh1Ck/8BbnhC0t4sdq6GQxFH6pDxNNxFa45qs58HejiDt/3Cnwpq14YY3JeQpK1LIE8gTlqdQJKwuWt8pFprg7Pl3JABWVnVZ1VXdMC6AcUoBKFBCO5FuwbYCFBgXFFiLSdNiSkGqqmY4urq6GU9VQ5a1qapr+uz6VtaNhTzVFc3UjfndRFE105wtb24mxmxRlHWaFU2LpabFimZqxvzesqeq0cX6XFZ0VZ9NVVPRTFnRx7LaXa10p+b8fmU7AYpbTCRgjFCKSeeOAHT71mZvlgIh9DHFT0GLSYsJAPsDylLRnmRzhZ0AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 1116 1a C2daF2jugjC8f2OhF1ng\",\n    \"title\": \"max 1116 1a C2daF2jugjC8f2OhF1ng\",\n    \"src\": \"/static/0b79c21d45b4c0e9afd59823246d8fb0/42a8d/max-1116-1a_C2daF2jugjC8f2OhF1ng.png\",\n    \"srcSet\": [\"/static/0b79c21d45b4c0e9afd59823246d8fb0/772e8/max-1116-1a_C2daF2jugjC8f2OhF1ng.png 200w\", \"/static/0b79c21d45b4c0e9afd59823246d8fb0/e17e5/max-1116-1a_C2daF2jugjC8f2OhF1ng.png 400w\", \"/static/0b79c21d45b4c0e9afd59823246d8fb0/42a8d/max-1116-1a_C2daF2jugjC8f2OhF1ng.png 558w\"],\n    \"sizes\": \"(max-width: 558px) 100vw, 558px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"But if you\\u2019ve never worked with SPAs before, instead of a full link preview, you might receive something like the following:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/9d1a3/max-4968-1iNUJrqnvOjpRZjEPneykIg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"13.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoUlEQVQI1yXJ2wqCMBgAYN//pSLowkznYRQZbvvnCE130h20riKC7+5LpDKz1HZxszJKW6mtNotSRipjVz/NSko9KyO1tavb35+47c7Hv+RwPKEKpxnK8jIrygI1OapRhcsa56iu8e18+VWaFVVzbR+EgfAhLmtYXUjubQcgOgLARUcBQFDGKeO9eDIQwzhRxgnllHIGPaF8GF8hbN5H7+MXalOfffNi4tkAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 4968 1iNUJrqnvOjpRZjEPneykIg\",\n    \"title\": \"max 4968 1iNUJrqnvOjpRZjEPneykIg\",\n    \"src\": \"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/5a190/max-4968-1iNUJrqnvOjpRZjEPneykIg.png\",\n    \"srcSet\": [\"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/772e8/max-4968-1iNUJrqnvOjpRZjEPneykIg.png 200w\", \"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/e17e5/max-4968-1iNUJrqnvOjpRZjEPneykIg.png 400w\", \"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/5a190/max-4968-1iNUJrqnvOjpRZjEPneykIg.png 800w\", \"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/c1b63/max-4968-1iNUJrqnvOjpRZjEPneykIg.png 1200w\", \"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/29007/max-4968-1iNUJrqnvOjpRZjEPneykIg.png 1600w\", \"/static/3f49ca915aa684f4cdea1fbd4fc1b7a2/9d1a3/max-4968-1iNUJrqnvOjpRZjEPneykIg.png 2484w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Nothing is being shown, just a plain URL for both the link title and link description. But why is this happening? \\uD83E\\uDD14\\uD83E\\uDDD0\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/bbf98856123a950d1b1db311171cd401/066f9/max-800-1GIe1zBCx_KbceMN4VuXhbA.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"100%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAEF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAB/9oADAMBAAIQAxAAAAGM7qwsTiz0LhWUG//EABsQAAMBAAMBAAAAAAAAAAAAAAECAxEABBIh/9oACAEBAAEFAhvH+hSSFmtA8PT9gFKxODTtVDN//8QAFxEAAwEAAAAAAAAAAAAAAAAAABARQf/aAAgBAwEBPwHSv//EABgRAAIDAAAAAAAAAAAAAAAAAAABEBIx/9oACAECAQE/AcRVT//EAB4QAAICAAcAAAAAAAAAAAAAAAARASECECMxMlFh/9oACAEBAAY/AuSg08d+j7E9hxQisnJ//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBYf/aAAgBAQABPyGxMFrZKUWdoDZYHq4iCp2p7HH5M5ERcq8iLxfZgbnZrU//2gAMAwEAAgADAAAAEEzwP//EABgRAQADAQAAAAAAAAAAAAAAAAEAEBEx/9oACAEDAQE/EDIWOR7X/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8QaYWbP//EAB8QAQADAAEEAwAAAAAAAAAAAAEAESExQVFxsWGRof/aAAgBAQABPxABBxQ0r3cNuAGAPjIyNVMAevEp8NyVjYd6sR0DCnxGdiA4Gm/tw24106ud46TdQTZQL+5//9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 800 1GIe1zBCx KbceMN4VuXhbA\",\n    \"title\": \"max 800 1GIe1zBCx KbceMN4VuXhbA\",\n    \"src\": \"/static/bbf98856123a950d1b1db311171cd401/066f9/max-800-1GIe1zBCx_KbceMN4VuXhbA.jpg\",\n    \"srcSet\": [\"/static/bbf98856123a950d1b1db311171cd401/e07e9/max-800-1GIe1zBCx_KbceMN4VuXhbA.jpg 200w\", \"/static/bbf98856123a950d1b1db311171cd401/066f9/max-800-1GIe1zBCx_KbceMN4VuXhbA.jpg 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Naturally, you begin to inspect your code, and soon, you end up looking at the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.html\"), \" that is initially served when somebody or something visits your website:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/01317e19a837f90ecb435441653a3f3a/bce1e/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"31.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVQY043LSQ4DIQxEUe5/z85AQxvMYGNsiKKsI/VTrUr6LgfIb0jAJXG8tFajbq0rkYksVVO19YfLmHz0hw/H+zzO5AEjYiMR2WP84rX/cAkSIKQKdZTGWBgrl2lz3+DiK5arMPOUaWp77ftcgPC4ns/r5fMZMAaMlerdGFPuRFil9cFERNzIBi8T1TmJd6c9xWyqDGu0ib/7PR9i4F8h4Tq3mAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 3392 1MAMWncuO6YZiruzIpA0YjQ\",\n    \"title\": \"max 3392 1MAMWncuO6YZiruzIpA0YjQ\",\n    \"src\": \"/static/01317e19a837f90ecb435441653a3f3a/5a190/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png\",\n    \"srcSet\": [\"/static/01317e19a837f90ecb435441653a3f3a/772e8/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png 200w\", \"/static/01317e19a837f90ecb435441653a3f3a/e17e5/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png 400w\", \"/static/01317e19a837f90ecb435441653a3f3a/5a190/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png 800w\", \"/static/01317e19a837f90ecb435441653a3f3a/c1b63/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png 1200w\", \"/static/01317e19a837f90ecb435441653a3f3a/29007/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png 1600w\", \"/static/01317e19a837f90ecb435441653a3f3a/bce1e/max-3392-1MAMWncuO6YZiruzIpA0YjQ.png 1696w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"As we can see, there isn\\u2019t much going on in this document. We only have a few basic HTML tags and a few links that point to the website\\u2019s JavaScript and CSS files. And this is to be expected because this initial HTML document is actually a part of our app\\u2019s production build. In other words, this document is not dynamically generated, but statically served every time the user visits our web site.\"), mdx(\"p\", null, \"This is a crude list that shows steps that are happening, once a user enters the URL of a SPA-powered website into the browser:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Initial SPA HTML is downloaded.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The download of files begins (CSS, JavaScript, images, \\u2026).\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Once the JavaScript has been downloaded, it gets executed, which usually means the beginning of SPA initialization, initial data fetching, and initial UI rendering.\")), mdx(\"p\", null, \"But what happens when the web crawler like e.g. Facebook\\u2019s web crawler visits the site?\"), mdx(\"p\", null, \"Well, it reaches the step one, and that\\u2019s pretty much it. Unlike regular users, web crawlers do not wait for the SPA to be fully initialized and then fetch the generated HTML. They will only analyze the HTML that was initially served to them, and that\\u2019s it. And this is the reason why Facebook\\u2019s web crawler doesn\\u2019t generate a complete link preview - the initial content simply doesn\\u2019t contain enough information.\"), mdx(\"p\", null, \"But social media web crawlers are not the only issue here\\u2026 more importantly, what about search engine crawlers and SEO?\"), mdx(\"p\", null, \"Although search engines are working on solutions that might do a better job of interpreting SPAs, to this day, we still cannot completely rely on these solutions. I\\u2019ve actually seen a couple of examples where introducing SPA\\u2019s significantly reduced SEO quality results, for example:\"), mdx(\"undefined\", null, mdx(\"blockquote\", {\n    \"className\": \"twitter-tweet\",\n    \"data-dnt\": \"true\"\n  }, mdx(\"p\", {\n    parentName: \"blockquote\",\n    \"lang\": \"en\",\n    \"dir\": \"ltr\"\n  }, \"Absolute slam-dunk. I think Spectrum is one of the few use cases where both React and SSR make perfect sense.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), mdx(\"br\", {\n    parentName: \"p\"\n  }), \"Attached graph: clicks to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://t.co/T9oO6x7R20\"\n  }, \"https://t.co/T9oO6x7R20\"), \" from Google search results. Guess when we introduced SSR? September. (ref: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://t.co/vtLi9Yf1Cn\"\n  }, \"https://t.co/vtLi9Yf1Cn\"), \") \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://t.co/uHu7hVe5aq\"\n  }, \"pic.twitter.com/uHu7hVe5aq\")), \"\\u2014 Max Stoiber (@mxstbr) \", mdx(\"a\", {\n    parentName: \"blockquote\",\n    \"href\": \"https://twitter.com/mxstbr/status/985188986414161921?ref_src=twsrc%5Etfw\"\n  }, \"April 14, 2018\")), \"\\n\\n\"), mdx(\"p\", null, \"Oh, man\\u2026 Imagine yourself working on a project for three months, and right before the launch, you realize you have no SEO support at all.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"692px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/d44d02f6881dab799b97b1e061805a8c/91e7e/max-1384-1wbnk2fdAGmNE-tavETSxgw.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"59.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC5UlEQVQozwXB608SAQAA8KsPTXPZY8syxzQDNNPA+UBEcDxTZCASwnEc3PE+8Hj4QF7HceJBMXwgapKKiY+0LFc5rdxqa7NP/VH9fkAhlzt4t7u2mH+/s/Plw8ftlZVf52flwvKfy8vLb9/KxfWfX89O9vdOjw4P1ksXR4eLM56Dwusv++W3dAJYosnKRrFAJ8tv1ve3NguZ+WJ+AQEtRIykyVR5MfV+a/24Ujksb+0WVk82VhcmnZVcam8pm/PbAQmHPdTVOiro1IhE0PBQb0vLLaCKUVXbVl3DrLoZcRimrboQgpiH5Qmn29LNtnAZFm4jzGXYepoBvYQPKoSISuIyvMRAQ/2d+611DUmlpGRUzg8PJF1mYgKN+7xe8GUaxzEpDxM+w8Ucn4Q7IeYA4/J+64jYqZVNwCYchoSPm8e7OHmjCuF3OXrawwhI4mjM6/UYdZQXcw1y7Tyms6/FM8D2CtkArOy1qQfdOmkAhUOo9ZVGXrLri5BqRT+U0UgIt47EESLox0x60u3EZLxZcDRi0MVNWgLSAnq5ABySImpFyG4NumweMS+tGozKemmlyMHrgKR94zJREDFPwMa4A8E1CmoynvCF01NJOkwBkGbEYdD5UTM56cPtSDbgi8h5kRf8MWaTqZ+f9vhcKiWkVAQQKGazYEpxAp+JYdMEPkuF4oADHPMhJg8MjqvUrY/b3yyvVTJJv7jb0sEaE4iyocgMDNm0yiBqjqIWu4QfxYJJf5QMRudmCECteNHL4bEa2xh1T6qu3dbINVc/LgQstvR5W83N6hvXqxtqHwja29HRkYBea+J3TLt9yWAsNRVPz5LAU2Znw/0nTfWsR/caLaDt5PjT7+8XGYr+evp5Ob/0is7Nz2Xzrxc+7FfOPx6ncZcfsaem4lSYoKMpgNXUwXjQ3FTPfHiXARvR8ubOUWVvnkj9+3u1tbGZSWfpuQyVTG9vlE73dhMua8jmpqYTdJTKJub+A9GRG/QUU2RaAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 1384 1wbnk2fdAGmNE tavETSxgw\",\n    \"title\": \"max 1384 1wbnk2fdAGmNE tavETSxgw\",\n    \"src\": \"/static/d44d02f6881dab799b97b1e061805a8c/91e7e/max-1384-1wbnk2fdAGmNE-tavETSxgw.png\",\n    \"srcSet\": [\"/static/d44d02f6881dab799b97b1e061805a8c/772e8/max-1384-1wbnk2fdAGmNE-tavETSxgw.png 200w\", \"/static/d44d02f6881dab799b97b1e061805a8c/e17e5/max-1384-1wbnk2fdAGmNE-tavETSxgw.png 400w\", \"/static/d44d02f6881dab799b97b1e061805a8c/91e7e/max-1384-1wbnk2fdAGmNE-tavETSxgw.png 692w\"],\n    \"sizes\": \"(max-width: 692px) 100vw, 692px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://twitter.com/doitadrian/status/1103366565746167809\"\n  }, \"https://twitter.com/doitadrian/status/1103366565746167809\"), \"?\"), mdx(\"h2\", {\n    \"id\": \"how-to-deal-with-this\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"How to Deal With This?\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#how-to-deal-with-this\",\n    \"aria-label\": \"how to deal with this permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"To this day, there\\u2019s basically only one way to fix this issue confidently, and that\\u2019s by serving meaningful HTML to web crawlers. In other words, when a web crawler visits your site, initially served HTML must contain things like page title, appropriate meta tags, the content (body) of the page, and so on. For example:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4cec0ddf2bbbf4b7bbb4be141a4b677b/47aef/max-2126-1xU1ZwSOTw0i70Dn8LVmbUg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"68%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAUlEQVQoz3VS2Y4bMQyb//+4Ai3a3eyik805R2yPL1mSzykmabZogRKEoReaBKWOgQkgxkxcmMra1ifak59zfQyf6GqqbNF7sBYACJ6D9xudI2MRfYpcc1lzXnO5f9Y2dq2tflTzWRxPTgzyfFB97/revrzhy1t4e4fdzr3s6Mcr9j18/c5fvvEwRmOLkLlb6xqUg0VJScHYoLWUtCxkLWvNzsUQEkDyPgFEgGRMxJBzqinVrpXVnIUfP+arHa8O5vN40eOEQpBzqdXcaim1lbKWupbaam05b8oYa9fqak635Xr9OMDh6PVwHg7z+QzTVckZ0Bq3WKWi1cGZsCysFtaGF81SUtdqA2HNrE8n6vfUf8Tjh/u559f3tHuP/T4c93C5RL1ELdC6klN9OG+xM2f2oHQCh+ScdZl8UKrMotxEm0Qb5jrdyjiVy9ikasY2CPeu17WrsWRkxMSUMLB1aB2CDwj+vrAAnjhw5kj85wYe6KJnN2mn4XYjo9BoQKScU0wpp/u7paztbtX+lnc1ZgpobHQ2Roi1tPavwX/RsSOQUgkQkm831AtpHb0jZyml+nCrtbU7n7f1+0i7xBF8tLNRJyEmKyUvCz2oFGtN3iJh8pAxxISw9Ro2TULsHgEKl+gdaK3mZRhoGHkYeBxJSytmqyROMwbgmmPNseRS89b2L0MII02NyBuoAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2126 1xU1ZwSOTw0i70Dn8LVmbUg\",\n    \"title\": \"max 2126 1xU1ZwSOTw0i70Dn8LVmbUg\",\n    \"src\": \"/static/4cec0ddf2bbbf4b7bbb4be141a4b677b/5a190/max-2126-1xU1ZwSOTw0i70Dn8LVmbUg.png\",\n    \"srcSet\": [\"/static/4cec0ddf2bbbf4b7bbb4be141a4b677b/772e8/max-2126-1xU1ZwSOTw0i70Dn8LVmbUg.png 200w\", \"/static/4cec0ddf2bbbf4b7bbb4be141a4b677b/e17e5/max-2126-1xU1ZwSOTw0i70Dn8LVmbUg.png 400w\", \"/static/4cec0ddf2bbbf4b7bbb4be141a4b677b/5a190/max-2126-1xU1ZwSOTw0i70Dn8LVmbUg.png 800w\", \"/static/4cec0ddf2bbbf4b7bbb4be141a4b677b/47aef/max-2126-1xU1ZwSOTw0i70Dn8LVmbUg.png 1063w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"But what would be the best approach to achieve this? Do we need a server that will dynamically generate HTML on each page request? Or are there other approaches we can use?\"), mdx(\"p\", null, \"Well\\u2026 this brings us to our next topic: rendering on the web.\"), mdx(\"h2\", {\n    \"id\": \"rendering-on-the-web\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Rendering on the Web\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#rendering-on-the-web\",\n    \"aria-label\": \"rendering on the web permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"There are actually a couple of ways to render apps on the web. A very useful resource, that I\\u2019ve seen referenced a couple of times, is this article, called \\u201CRendering on the Web\\u201D, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.google.com/web/updates/2019/02/rendering-on-the-web\"\n  }, \"officially hosted on Google blog\"), \". The document can help you get a good overview of different rendering approaches, and also give you information on all of the pros and cons of each one.\"), mdx(\"p\", null, \"At the end of the article, we can find a very nice summary of all rendering approaches that we can utilize today:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/a62d5a0dbbf2c40f0b8448f4c1347d12/016a8/max-3152-1Wr_Vu82hG3lU8Cn7BIiK5g.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"64%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACAUlEQVQozz2R227jMAxE8/8ftyjy0iQo3NTOxbIl634lRS6cTXeeCEKDQ80c+FfK5lwAOwMQdkKkhgS4z/A7YKcGvUEXKuaCh//mx6JXE6FzQ3IJUu2dOFX0GaEzIPsMue3L3Pr0VKnA25wLXB/6a5R3oeXmv0Y5PrV18XRd/5zui7SLch/n5+VnNTbchf15aG3T2wwA4/gj5mdKUQgxjaOUq7N2mqbH4x6CXxZx/f6e59k5d7tNP9ers/ZARK21Wuvn5+f5fGmtCSGOx+M0TQBwPp9PpxMArOv68fGxLAsRXS6X4/Gotd7JRAQAQghjDAA454Zh0Foj4jzP67r+Wzrnaq2ttfklADj03lNKtdZtlwaAGKOSW0qptbZtets2RIwhbGqrpQKA3nSMkZkOvVOMsZSijbXWElFM2Ri7/6W1YfieZ8HMxthxHPfTEK1127a9ybW2DkUt92WVAFCCnPfkMhNao3MuzJy8XMRca6PepJiMsdT7bkYkpmrkpI0l5qyHYfhyPnCvwamYMjO3uCq5InamZtXNucDMh1dayARGPUOIe23ZKCVDzNScfA7T7dE7QrXGaO8D9RbdumPoRfbelVKkVEqpUop1fp5naw1il9ovqwIA70Pw/lVq09oQ0ZuMiL33V9l7EwBQ654qEeXaS0Pm/U0ppdZKRLWW/X7mv3f+5d+EDHEjAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 3152 1Wr Vu82hG3lU8Cn7BIiK5g\",\n    \"title\": \"max 3152 1Wr Vu82hG3lU8Cn7BIiK5g\",\n    \"src\": \"/static/a62d5a0dbbf2c40f0b8448f4c1347d12/5a190/max-3152-1Wr_Vu82hG3lU8Cn7BIiK5g.png\",\n    \"srcSet\": [\"/static/a62d5a0dbbf2c40f0b8448f4c1347d12/772e8/max-3152-1Wr_Vu82hG3lU8Cn7BIiK5g.png 200w\", \"/static/a62d5a0dbbf2c40f0b8448f4c1347d12/e17e5/max-3152-1Wr_Vu82hG3lU8Cn7BIiK5g.png 400w\", \"/static/a62d5a0dbbf2c40f0b8448f4c1347d12/5a190/max-3152-1Wr_Vu82hG3lU8Cn7BIiK5g.png 800w\", \"/static/a62d5a0dbbf2c40f0b8448f4c1347d12/c1b63/max-3152-1Wr_Vu82hG3lU8Cn7BIiK5g.png 1200w\", \"/static/a62d5a0dbbf2c40f0b8448f4c1347d12/016a8/max-3152-1Wr_Vu82hG3lU8Cn7BIiK5g.png 1576w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"As you can see, the summary is packed with useful information. Let\\u2019s quickly go over each one.\"), mdx(\"h3\", {\n    \"id\": \"full-csr\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Full CSR\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#full-csr\",\n    \"aria-label\": \"full csr permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"We\\u2019ve already seen this approach previously. The backend returns a simple HTML, after which the app initialization happens in the user\\u2019s browser. Not great for SEO, but if you\\u2019re building something that doesn\\u2019t require it, like for example an admin UI, then it is still a good approach.\"), mdx(\"h3\", {\n    \"id\": \"csr-with-prerendering\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"CSR With Prerendering\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#csr-with-prerendering\",\n    \"aria-label\": \"csr with prerendering permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"If you\\u2019ve ever worked with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.gatsbyjs.org/\"\n  }, \"Gatsby\"), \", you\\u2019re probably familiar with this approach. Basically, once we\\u2019re ready to deploy your website, we start a build process, which generates all of our app\\u2019s pages in advance, which can then be uploaded to static file storage, e.g. the Amazon S3.\"), mdx(\"p\", null, \"Since built pages contain complete HTML and nothing is dynamically generated, the app will be served super fast, and most importantly, will possess excellent SEO support.\"), mdx(\"p\", null, \"The catch of this approach is that, whenever you need to make a change, even if it is a small one, you need to completely rebuild everything from scratch, and on larger projects, this can take time. So if you\\u2019re making changes often, this probably won\\u2019t be a super convenient approach for you.\"), mdx(\"h3\", {\n    \"id\": \"server-side-rendering-ssr-with-rehydration\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Server-Side Rendering (SSR) With (Re)hydration\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#server-side-rendering-ssr-with-rehydration\",\n    \"aria-label\": \"server side rendering ssr with rehydration permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"In this approach, we dynamically generate HTML on every initial page request, server-side. Notice the word \\u201Cinitial\\u201D here. What we meant by that, is that the server-side HTML generation will happen only on the initial page request, e.g. when the user enters the URL into the browser, or when the user does a full page refresh. The interesting part is that, after the initial HTML is received, a full CSR SPA is initialized, meaning all of the HTML from that point in time will be generated in the user\\u2019s browser, thus still creating a great UX. This approach is also referred to as the \\u201Cisomorphic rendering\\u201D.\"), mdx(\"p\", null, \"Sounds awesome, but do note that in this approach, you actually need to create two separate production builds of your app, one that will still be served to and executed in the user\\u2019s browser, and the other that will be executed on the backend to dynamically generate the actual HTML. The reason for creating two builds is different environments \\u2014 running browser code in NodeJS backend simply doesn\\u2019t work (and vice versa).\"), mdx(\"p\", null, \"Although SSR can sometimes be non-trivial to set up, once you learn a few tricks, you should be OK (setup yes, performance is a whole another thing). Using frameworks like for example \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://nextjs.org/\"\n  }, \"Next.js\"), \" can significantly save you time in doing so.\"), mdx(\"h3\", {\n    \"id\": \"last-two--static-ssr--server-rendering\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Last Two \\u2014 Static SSR & Server Rendering\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#last-two--static-ssr--server-rendering\",\n    \"aria-label\": \"last two  static ssr  server rendering permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Static SSR, as highlighted, includes JavaScript removal in the build process and it\\u2019s used to serve plain static HTML pages. If JavaScript removal is acceptable for your particular use case, then this approach might be useful to you.\"), mdx(\"p\", null, \"The last one, pure server rendering, doesn\\u2019t belong to the SPA category since it doesn\\u2019t rely on any client-side rendering at all. HTML is always returned from the server, and navigating through your app assumes a complete page refresh. It\\u2019s basically the exact opposite of the Full CSR we\\u2019ve explained first.\"), mdx(\"h2\", {\n    \"id\": \"what-to-choose\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"What to Choose?\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#what-to-choose\",\n    \"aria-label\": \"what to choose permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"484px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/f33f885f564f5fa0f3e320b2b65a5a2f/ff42b/max-968-1ywQML98aud3Zj1EL_Xfb8g.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"113.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFhklEQVQ4ywF7BYT6ABYgJxgkLDhFO0BPPR8sKxwoKi08N2BrY5+hnZ6hoJqfnp+ioXN3dUBNQ0dTTUFIQC83NCw2NS47OjdCOwAYISYZJSg6STo8TT0dKSocJyk6S0SOnJDCwrvKy8PNzcS1uLN3fn9BT0pKU0tDST8oMC4lLjAuOzouOzcAGCEkGCMmNEI7PUtEHikrHCkqbYJ4tcWxzMzKubm4tbWyr7CrrbCpiJGQWmNhOEA5Nz87U15PW2hRO0Y/ABceIBchJDNDPztIPRsiIzhISae9p7/MsLK9rMDHs9jeytPXxsvQuOfjy8vNwYGJdmZvUlhgPDc+MCwzMwAVHB4YIyQ7SkEyPDEhKy1gdnWXrJbI273I2LumuJyRoYp/jHBzfmC1tZTIy7hYYElkb05BSTkgJysqMjAAICgmJjAvRFJHMD03Sl5jhpyYdYtzboJreYhwV2RKXm1WWmVLZW9dp6eMpqeekJuNb3lkJiwtIykrMTgwAEdMN1xhQVlfQ1VeRHF+a5Wmnl5wW0RNNml4a11qT4OYhH2KcTU9JoKIcK+tloeOgzQ8OCAmJiEpKzQ6MQAdJSA5QStRWDVbY0FERC45PjZXZ1JEUDkzOypndlZWZ0mDlHmCkW8/RiR1cmJyeXorMC0iKCgfJykwNy8AIigpFyEiMzssVmJJX2pRP0UxQkUsRFA0RU4rWGRBaXpZcX9jZWpLPzwZhX5xaW9wIiglICYmIScoMjcsACIpJhcgIR4mJRwjITtIQlFgVjM5JS8xGDc6HTtAIztDJDI3Gzs5HEhAHYWDd1BXVBEZFxohJSEoJzc7LQAgKSUSHB0WICAcKCQzQ0RZa2SKlII+PigYFwckIxArLBQuNR82NRs/Ox2qo4za1LugnokiLCkaIR46PC0AKzEkMDUkNjokOD8nU2FPu8K0wcW3KCsfFRUIHBsMHx0MKCUOJSQOLSMRlIl0tqyQw7WUrq2VQkc8MzUkADpBKU9XNEVIKFpeNKaxpZOhokxXTDE3LwwMBwwKBQ4LBhkVCRYSCRsOBKOYgObdvoF0Vb+3m729qC4yJAAbIh4ZHxsKEA9gbmifrq5seXA9PixRWEobGxkEAAANCAYPCQYdEwsdEgh/fW3//+/28daro4zKybJdXk0AEhgYEBQVDBERcIGElaKgc31xPDkmS04+QEQ8CQYDCwYCDAQAEQcBICEdbHRrraaRppl+OjUigH5rmZiCABYgIQ8aHSc1NnyOinmHgG9+dUhMOjAuHUhKOUpNQEFBN2JbSFlPOzItJG1nTFNDIz0uHCQbDGFiU+PgyQAUICEQHSJpenp0hHhMWUhaYk5PU0AaFgQlIhBCQis1Lxudm3WMkmySn4WlpoRPRC4UAwEoFAhzcmjv6NAADxgbFycqk6ikZ3NoTVM9UFdBREQwamdgW1xVYV5UXVpUYVtSh4NzlaWMdIBep6aJjYBpRjMfkYx89fDWABAXGRUlKY6fmJyrolphVFVaQWNpW6mpqnp7eISFgMvMysDCwMbIx3p1aHxsTHx+Xq2umt7awevoy+DWvAAQFxkOHCNDT0vL1sWYo5ZKTDaAh3WtsJvJybHDw7q8vLmOkYI1OSBfYkhqXUSKdVJSVj2ipJzRy7jTyrUACxETDx0kHicef4t+zNjKp6+gvsW0w82/oaudn6KcsLSyu72wc35pLDcvCgcAVkcyTEoydnt2wb6wv7ahAAgMEBIfJUZSRkZMOGBsXnB+b3GBdnyLiVprZ2FrV5ekkm91aSsuIycvKBIRCwwLBCYlGEJHPZGVjMS+qwAGCw0OGh59in9sdWFQWkRgblxsfG5/i4N3h4F2gnNeZFBdX1MdGhAgJh4SEQsSEQslJx41NylITkRucmZhd+lX1rUu9AAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 968 1ywQML98aud3Zj1EL Xfb8g\",\n    \"title\": \"max 968 1ywQML98aud3Zj1EL Xfb8g\",\n    \"src\": \"/static/f33f885f564f5fa0f3e320b2b65a5a2f/ff42b/max-968-1ywQML98aud3Zj1EL_Xfb8g.png\",\n    \"srcSet\": [\"/static/f33f885f564f5fa0f3e320b2b65a5a2f/772e8/max-968-1ywQML98aud3Zj1EL_Xfb8g.png 200w\", \"/static/f33f885f564f5fa0f3e320b2b65a5a2f/e17e5/max-968-1ywQML98aud3Zj1EL_Xfb8g.png 400w\", \"/static/f33f885f564f5fa0f3e320b2b65a5a2f/ff42b/max-968-1ywQML98aud3Zj1EL_Xfb8g.png 484w\"],\n    \"sizes\": \"(max-width: 484px) 100vw, 484px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The summary shown above can definitely help us in choosing the right approach to render our app. But which one should we use?\"), mdx(\"p\", null, \"Well, it depends on the app you\\u2019re building, or in other words, on specific demands and requirements that are in front of you. If you have a simple static website, then CSR with prerendering is definitely a good choice. On the other hand, if you\\u2019re creating something more dynamic, then, depending on your SEO needs, you might want to go with SSR with (re)hydration or a simple full CSR SPA.\"), mdx(\"p\", null, \"So, doing a quick analysis of your app will certainly help you in choosing the right approach, which is exactly what we did at Hoola AI, in order to improve our Page Builder app.\"), mdx(\"h2\", {\n    \"id\": \"the-page-builder\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The Page Builder\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#the-page-builder\",\n    \"aria-label\": \"the page builder permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"The following diagram, on a high level, shows how Hoola AI Page Builder initially worked:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/ae67aaad8a8811e2b18ed238accc0d50/ea964/max-2624-1WOaQDykPt1XnFMdlKh5AVw.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"48%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoUlEQVQoz3WSO2/UQBSFXVHR0fIv6PgD/AAqCpooPAokREtBKort6CLQIqWioEAKBCjoeESAEMVqAybCUjzrNTv2ejL22J7nvRcchBTCcsqj8x2dK93IGKO1pmMCgBCCc947B0dCxOMBRFRKIWKUJEkcx7rva7EU5UyUuevqmC0/TlOtlDHGWdc2dVXkcpnJqkTb5fOMMcY5j8qy5Jx77yCA7b56K4MPTbFohLDOSSmbVjkPzhyaNgYPBL6pa865Uir6PezEbASPBAFRa90a04dAqxTRf4RIf186eEcu4NAO/8IwJFZVrfT/zEYA79t6z2pBRC+2ZuM78XjjWzKRRKGtE61SIGo+72Sb6/PNdfn20QCzNP2eJN4ap1tR8E5JIrx3c3r74qdbFz7sPv/hXCWKQomiRyqe3P2ydia+fjZ/eGOA8zxnjBmjm8OqrmayWtiuGV2ZXDv/Zu3c63c7C6JeFJngaWeBP96YXjq1d/n0/P7VAfbDLzgiDB5MF3srCen9y+Lpg/TZmM2Tloh0e2C7DIm6/d1ye1Ruj9Tk1S/4J00rJ280d1wfAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2624 1WOaQDykPt1XnFMdlKh5AVw\",\n    \"title\": \"max 2624 1WOaQDykPt1XnFMdlKh5AVw\",\n    \"src\": \"/static/ae67aaad8a8811e2b18ed238accc0d50/5a190/max-2624-1WOaQDykPt1XnFMdlKh5AVw.png\",\n    \"srcSet\": [\"/static/ae67aaad8a8811e2b18ed238accc0d50/772e8/max-2624-1WOaQDykPt1XnFMdlKh5AVw.png 200w\", \"/static/ae67aaad8a8811e2b18ed238accc0d50/e17e5/max-2624-1WOaQDykPt1XnFMdlKh5AVw.png 400w\", \"/static/ae67aaad8a8811e2b18ed238accc0d50/5a190/max-2624-1WOaQDykPt1XnFMdlKh5AVw.png 800w\", \"/static/ae67aaad8a8811e2b18ed238accc0d50/c1b63/max-2624-1WOaQDykPt1XnFMdlKh5AVw.png 1200w\", \"/static/ae67aaad8a8811e2b18ed238accc0d50/ea964/max-2624-1WOaQDykPt1XnFMdlKh5AVw.png 1312w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"So, in the upper diagram, we have admin users that can, via the admin UI, create new or edit existing pages. The whole admin interface is a full CSR SPA (created with popular \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/facebook/create-react-app\"\n  }, \"create-react-app\"), \"), and there\\u2019s nothing wrong with that. \\uD83D\\uDC4D\"), mdx(\"p\", null, \"On the lower diagram, we have a public-facing website and regular users, to whom we also served a full CSR SPA. Nothing super advanced here \\u2014 basically once the app has initialized, via the GraphQL API, the app would fetch the content that needs to be shown for the user\\u2019s current URL, and that\\u2019s pretty much it.\"), mdx(\"p\", null, \"Of course, as we\\u2019ve learned, for the public-facing app, the Full CSR approach won\\u2019t be good enough, because public pages must have SEO support. There\\u2019s just no way around it. So the time has come to consult the Rendering on the Web document and try to pick the best approach for the job.\"), mdx(\"h2\", {\n    \"id\": \"what-weve-chosen\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"What We\\u2019ve Chosen?\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#what-weve-chosen\",\n    \"aria-label\": \"what weve chosen permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Because the Page Builder is dynamic in nature, meaning once a user hits the publish button in the editor, the page must go live immediately (and of course be SEO compatible), we\\u2019ve chosen the third approach, and that\\u2019s SSR with (re)hydration.\"), mdx(\"p\", null, \"But, because we knew that, at the time, our codebase would require a significant amount of changes for it to work, we actually had one more idea that we wanted to try first. What if we could, from the backend, visit the URL, as if the regular user did it, and return that whenever a web crawler is making a request? You know, just simulate the regular user, wait for the full UI to be generated, take the final HTML, and just serve that? For the regular users, nothing would change, we would still serve them a regular SPA, because, in reality, users don\\u2019t care what HTML they initially received from the backend (actually it turns out it \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"does\"), \" matter, more on this in the following sections).\"), mdx(\"p\", null, \"That could work we thought, so we tried it. We\\u2019ll call this approach \\u201Cprerendering on-demand\\u201D.\"), mdx(\"p\", null, \"So to summarize, we\\u2019ve decided to try the following two approaches:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"prerendering on-demand\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"SSR with (re)hydration\")), mdx(\"p\", null, \"Let\\u2019s see how we\\u2019ve implemented these rendering methods in a serverless environment, and of course, which one gave better results.\"), mdx(\"p\", null, \"As mentioned, please note that as we\\u2019re currently only working with AWS cloud provider, the implementation will be specific to it. But if you\\u2019re hosting your app on any other cloud, I believe you should still be able to achieve the same thing, using similar services that your cloud provider provides.\"), mdx(\"p\", null, \"All right, let\\u2019s take a look!\"), mdx(\"h2\", {\n    \"id\": \"prerendering-on-demand\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Prerendering on Demand\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#prerendering-on-demand\",\n    \"aria-label\": \"prerendering on demand permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"To implement prerendering on demand, we used the following AWS services:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/59cc4aabe91d7ad07c241c019153a36b/d5bfb/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"25.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQY02NYeXJu5sKQoqUxhWvSbh+c+7Qn+NHEyPsNDt/unP4PAv9ePv42seBKT9bl9pSL+1Y9m113c0L+lQkFV5d03mGYsKvJf4J56lzfuEVBp1aUPcjXuN/mcSWC9fOFnRDNj29/qQg83ZJwvjrkzIr+e51pF9uTL9aFn+3LucwwaVezc4dG6CTrqPl+Z1dXPao0f9AdcCtfHa75yZ0vNSFn25JAGlZNuNefe6Up9nxTzPlJRVcZlp+YnTYvoGBxZN6q5NsH5z7rDXnQE/Kgzevb7VNwZ/fnXepMv9CefGHvyqczq691Z17sybq4uOM2w//////8+fPz10+w0v+/f/38/Onj759QLgT8+PHzCwh8/ffv3/fv3798/vrp0+cfP74DAO3D1QBzRqmsAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2144 1nXboEpjsX4LQDTV9Ahex2g\",\n    \"title\": \"max 2144 1nXboEpjsX4LQDTV9Ahex2g\",\n    \"src\": \"/static/59cc4aabe91d7ad07c241c019153a36b/5a190/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png\",\n    \"srcSet\": [\"/static/59cc4aabe91d7ad07c241c019153a36b/772e8/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 200w\", \"/static/59cc4aabe91d7ad07c241c019153a36b/e17e5/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 400w\", \"/static/59cc4aabe91d7ad07c241c019153a36b/5a190/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 800w\", \"/static/59cc4aabe91d7ad07c241c019153a36b/d5bfb/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 1072w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"So, we used a single S3 bucket that would host the production build of our SPA, a couple of Lambda functions, and finally, API Gateway and CloudFront to make everything publicly available on the internet and enable proper caching, respectively.\"), mdx(\"p\", null, \"For this, we also used the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chrome-aws-lambda\"), \" library, which is basically a (headless) browser that we can programmatically control inside of our Lambda function. We will use it to visit the URL that the web crawler requested, wait for the SPA to be fully initialized, grab the final HTML that was generated, and finally return the output to the web crawler.\"), mdx(\"p\", null, \"For starters, let\\u2019s see what happens when a regular user visits a page.\"), mdx(\"h3\", {\n    \"id\": \"regular-users\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Regular Users\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#regular-users\",\n    \"aria-label\": \"regular users permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4c66fc398002a9c0dc91d9af00633abe/8a69d/max-2418-1IcS0wuiGtEVHd4KeuLZcfg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75.99999999999999%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC+0lEQVQ4y6WTSUxTURSG//dAikpCTCAYk6IWoQwKAmVoy9SHYIGWaiiDVkEtQhksICAFEqoGC6kYNWhEYGGQaI1xIUbjhCgokwwCsWXUyEYTN5K4ksUxj4V705uczZfc797z33MBJ5ajLMTFXhIEe3GAcak+iRxlIb+d8WHeuN9l3hgGR2lQ2XJTKi3Wyn46JbTpZYytMA73C+N3Pczfr7TppSlYnpBgZjAckwMRWJ2NAUAoShxCCfcO5Sn9eN6rhX04GrQOHI+c2eBnDvZjcUQFojdYrRThW8lufCnwwrfTQiA+PgHq9EQQTYNICSJCk26cuWGaYy+enGaajwJEiaC1LrQaRphrNbOsOX+aedzM81zQuAxfy/cwX2ujXVdKxa6QyeTIUCZgcJI/MYWl9T8w50+g3TSHZv00eur4jXHsr0kzYy0dQ3vdHM4XfMLaa54fYmlWxqxUirF8Ph12QyAglcs9FNIEt7kakfvTjvA98CEYlR8qG4+M2atUQ2YQ4WW33J+Pwpg2YjiXNeKoUr238Lz/doiYIICjKODQQnX0R3uR/zNwHBeRzHFC9Xa4x+wUefMtm7Sj91oMU2TKHnsBgFEERvnwvD5ntNtSvMHfA3DVBHn5EF2FwxBQv2JW0sLZKEJjY8PW8ooLm0q4LZtf9Yb721RwqUgfyDHlDt2tynx7gn/NJ11RAR87IDCmDamrDw/2VKnf6Xn+6s4+sbIYgqkyicJeG9fxuUZuhU6nQ1Z2LjJFAhyXeKMuGYjCOvLdCEEgSLcBxyRCmBSAPngeqSDofL8jS+qHgjAWpxJD+TABzzYXPhZotVpoNIeRKXJDXqQ3qjlAAsIxhhheKPEA8iKFqNkQLjFKEKPz/cHkxIvRZRYyA7ZAjPUF+5Ymee14cMUv8N+QdnZ2/neRFaAT/AU9GQDsI3dsduqnpFklbJpVgmRLmObozdRh1eXYPqeE6rYY18y2WBxsDW8ouJVB2dcV5JTwgCWUTbbsBXcpJC7DGt2R0hLa8hd+uD2P8LWiwQAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2418 1IcS0wuiGtEVHd4KeuLZcfg\",\n    \"title\": \"max 2418 1IcS0wuiGtEVHd4KeuLZcfg\",\n    \"src\": \"/static/4c66fc398002a9c0dc91d9af00633abe/5a190/max-2418-1IcS0wuiGtEVHd4KeuLZcfg.png\",\n    \"srcSet\": [\"/static/4c66fc398002a9c0dc91d9af00633abe/772e8/max-2418-1IcS0wuiGtEVHd4KeuLZcfg.png 200w\", \"/static/4c66fc398002a9c0dc91d9af00633abe/e17e5/max-2418-1IcS0wuiGtEVHd4KeuLZcfg.png 400w\", \"/static/4c66fc398002a9c0dc91d9af00633abe/5a190/max-2418-1IcS0wuiGtEVHd4KeuLZcfg.png 800w\", \"/static/4c66fc398002a9c0dc91d9af00633abe/c1b63/max-2418-1IcS0wuiGtEVHd4KeuLZcfg.png 1200w\", \"/static/4c66fc398002a9c0dc91d9af00633abe/8a69d/max-2418-1IcS0wuiGtEVHd4KeuLZcfg.png 1209w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"When a regular user visits the site, the HTTP request is redirected over the CloudFront to the API Gateway, which will invoke the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \". We gave it that name here because, in a way, it actually acts as a regular web server \\u2014 based on a received invocation payload (HTTP request), it serves requested static assets (JS, CSS, HTML, images, \\u2026) from an S3 bucket. A few extra capabilities of this function are sending proper caching response headers when a static asset was requested, and the detection of web crawlers, for which we used the\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isbot\"), \" package.\"), mdx(\"p\", null, \"So, if a regular user made the HTTP request we simply return the requested file, by fetching it from the S3 bucket and sending it back as an invocation response to the API Gateway, which will then return it to the CloudFront.\"), mdx(\"p\", null, \"What happens when a web crawler visits the site?\"), mdx(\"h3\", {\n    \"id\": \"web-crawlers\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Web Crawlers\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#web-crawlers\",\n    \"aria-label\": \"web crawlers permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"In this case, the HTTP request again reaches the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" over CloudFront and API Gateway, but instead of fetching the file from S3, we are invoking the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Prerender Lambda\"), \", which internally utilizes the mentioned \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chrome-aws-lambda\"), \" library to fetch the complete HTML for the requested URL.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/726b644e28dd68b5f8eda2bb7d6e2d49/5c744/max-2412-1-z_wWFnG4fFFHT492J_sRA.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"76.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAADb0lEQVQ4y6XSXUyTBxQG4Pf7Sisgdct0jkX+Ci0thUKlVaAREoTZUtqpAxGR0QLW8lMRBqmoOEmMVcCkEYgOglPBuTGIghodwxigCwaDlAZox48yGbtZN7Mti9tudha42NWyZeFN3py7JzknB/iPtNmFeOJS4OnCNtQY3sb7Ij6+t0Rg+pAAnjIp9+sjcXCXiOvnT6SSp0y68K/YeFE4ButEcF+VgciMioOB4AOgMtEKyHWXRG6YP5kOT3l03cJpDc3VJE79IzRjEqzWYxLAdUmKBYcCS88TeIO9MUEAAgaMIQHflEb4jhVHcruLk3GzKEXQUxCv7jQkJePVd0n48VkiXj5PwA/zKhC9hZJtD9GRZQV9BXirZKApCw6rBHxT2qbwptJg0VJKBDtzQwraGYzXUvgQdISyAMdXszfQH0NDw5y7d3rYyYHdIDKA6GecLHQxpTZirptaWGdhCHciL9TvkXaL7xWLPGBxPPMNcgNXPl6/uk1fsxhP+mPDipUbg++1imMw8MUA+nu7sDi5D0QHWaLPmfpDTmQ0EygX7NIRiR/dl68jugS7pQOf2XtQb1xGpQkgymKJLuLXjxSrONFdYMQxbO+9/anlj+tnedfORAmnboNXoR6tOHVgdO4D3ciZySRwb7XGi+5ZwTmqHbVas0Y9VTrHCRCh3x4TRSFmeMzi/Lnq7U73YWEXPLOzNO58Oj3R3cQP4vE3A+Acy35841yJk2r3jT0E4JMYLgpcmcdzxvps5gk6njN2BwCjlwRtIboMT6mk4Vl9Bs1WKX7Ct17vjkcTrq0spOyXnXKhsxP+FvVQdu1+R1elfqhIBnAeXIsXdVuw7mjmSG713pHOSt1wHhFh8GqcRFAO7qRFqZmxJndMVas+xMtXv+Hx3CJs76XiXaE/TmuBWPyOApYgBiF1M3BA9iZOafxQEPoCaSAYIl9gt4KBMdoPGSo5aOV+ZoA2AFj2elmHa5ptyE2DRrgexzJWwD+RD2KiQFC9DmTFbkLNLh4MYcvMOyDGKFli9AogT8nHRoShzQjmwcUdPp/Uctm/n7m9vf1/N6c1FfmXNdhjV6GupxyGtkysKdpGJUfbqIT6vDw7tyV9UHchoWVNoK4pwUd/IRHq81ubCtv0tL857Zc1gek2GZtuk2Hn2Wi9rnF7365zcQ1/AYbdaLJnKIyHAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2412 1 z wWFnG4fFFHT492J sRA\",\n    \"title\": \"max 2412 1 z wWFnG4fFFHT492J sRA\",\n    \"src\": \"/static/726b644e28dd68b5f8eda2bb7d6e2d49/5a190/max-2412-1-z_wWFnG4fFFHT492J_sRA.png\",\n    \"srcSet\": [\"/static/726b644e28dd68b5f8eda2bb7d6e2d49/772e8/max-2412-1-z_wWFnG4fFFHT492J_sRA.png 200w\", \"/static/726b644e28dd68b5f8eda2bb7d6e2d49/e17e5/max-2412-1-z_wWFnG4fFFHT492J_sRA.png 400w\", \"/static/726b644e28dd68b5f8eda2bb7d6e2d49/5a190/max-2412-1-z_wWFnG4fFFHT492J_sRA.png 800w\", \"/static/726b644e28dd68b5f8eda2bb7d6e2d49/c1b63/max-2412-1-z_wWFnG4fFFHT492J_sRA.png 1200w\", \"/static/726b644e28dd68b5f8eda2bb7d6e2d49/5c744/max-2412-1-z_wWFnG4fFFHT492J_sRA.png 1206w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"There are a couple of things to note here, and the first one is that the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chrome-aws-lambda\"), \" can become expensive to run because it requires a significant amount of resources. The library\\u2019s docs state that a minimum of 512MB of RAM should be allocated, but also suggests to allocate 1600MB or more. This is the reason we didn\\u2019t put all of the logic into a single Lambda function (into the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \"). The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Prerender Lambda\"), \" function will only get invoked when a web crawler visits the site, which is less frequent than visits from regular users. For serving simple static assets for regular users, a Lambda function with basic 128MB or 256MB of RAM will suffice, and thus save us some money along the way.\"), mdx(\"p\", null, \"While we\\u2019re here, here\\u2019s a couple of tips regarding the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chrome-aws-lambda\"), \" library as well. Configure it in a way so it does not download the resources that don\\u2019t produce the DOM, like CSS and images. You don\\u2019t need to load these in order to get the complete HTML. This will speed up the HTML fetching process significantly.\"), mdx(\"p\", null, \"Also, to make your deployments easier, you can also utilize the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"chrome-aws-lambda-layer\"), \" library, which basically lets you attach a public Lambda function layer that contains all of the necessary code, to your function. This means you won\\u2019t have to upload all of the code (and the Chromium binary) by yourself. You can reference this layer super-easy via the Lambda Console or even better, using the Serverless framework. The following \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"serverless.yaml\"), \" shows how to do it (note the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"layers\"), \" section inside of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"preRender\"), \" function):\"), mdx(\"deckgo-highlight-code\", {\n    \"highlight-lines\": \"undefined\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"service: mySiteServiceprovider:  name: aws  runtime: nodejs10.xfunctions:  preRender:    role: arn:aws:iam::222359618365:role/SOME-ROLE    memorySize: 1600    timeout: 30    layers:      - arn:aws:lambda:us-east-1:764866452798:layer:chrome-aws-lambda:8    handler: fns/my-server/index.handler\"), \"\\n        \"), mdx(\"p\", null, \"Note: for a full production environment, you might also choose to build the layer yourself, giving you much more control and better security posture.\"), mdx(\"h3\", {\n    \"id\": \"the-results\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The Results\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#the-results\",\n    \"aria-label\": \"the results permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"All of the pros and cons are shown in the following image:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/ac0c00150a14c5e6af485875a837343f/4b4ec/max-5152-1k0qav6kdut77D8tKUdj0-g.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"39.49999999999999%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA90lEQVQY023Q244DIQgGYN//+XrT+01bOzgFxMOMjGyq6SGb/S6IJvyB4OzLcRy99/EcVdkafL5mfXj3u/ertXY+ny+Xy+x61p2s3mfGzHLOp9Pper2+xzgRISJmJqKUUq1VVbU1Pcwq9bRwTMyMiCKCiMwch5SSQ8TwMsOjlly3nunA+4M4ADDzNtRaSyk559aaI6LvMDOLCBOVbbMUNdxhfQAAInrvlwEGVX1ORsT4MsPrum6qJtIBMMYAEEIAACKaC8cYSykupaSq9se4UMdoy4qR/e0GAN77EEKMMecsIjlnZ/+a10bRn2Vlmnsyc2tte9n3/RcXys0wvZ7gaAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 5152 1k0qav6kdut77D8tKUdj0 g\",\n    \"title\": \"max 5152 1k0qav6kdut77D8tKUdj0 g\",\n    \"src\": \"/static/ac0c00150a14c5e6af485875a837343f/5a190/max-5152-1k0qav6kdut77D8tKUdj0-g.png\",\n    \"srcSet\": [\"/static/ac0c00150a14c5e6af485875a837343f/772e8/max-5152-1k0qav6kdut77D8tKUdj0-g.png 200w\", \"/static/ac0c00150a14c5e6af485875a837343f/e17e5/max-5152-1k0qav6kdut77D8tKUdj0-g.png 400w\", \"/static/ac0c00150a14c5e6af485875a837343f/5a190/max-5152-1k0qav6kdut77D8tKUdj0-g.png 800w\", \"/static/ac0c00150a14c5e6af485875a837343f/c1b63/max-5152-1k0qav6kdut77D8tKUdj0-g.png 1200w\", \"/static/ac0c00150a14c5e6af485875a837343f/29007/max-5152-1k0qav6kdut77D8tKUdj0-g.png 1600w\", \"/static/ac0c00150a14c5e6af485875a837343f/4b4ec/max-5152-1k0qav6kdut77D8tKUdj0-g.png 2576w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The most important thing to note here is that, although we\\u2019ve managed to achieve good SEO support, we were unfortunately faced with a serious speed / UX issue.\"), mdx(\"p\", null, \"Because the user is still receiving a full CSR SPA, on each request, he has to wait for the initial assets (JS & CSS) and also page data to be loaded. While this is happening, the user is presented with a loading screen, and basically, every time the user visits a page, he will be looking at it for 1\\u20133 seconds, which is definitely not a great UX, especially if we\\u2019re talking about showing simple static pages. It is slow, simple as that.\"), mdx(\"p\", null, \"Even though we\\u2019ve tried a few things to improve on this, ultimately we couldn\\u2019t get it to work in a way that would satisfy our goals, so the prerendering on-demand idea was discarded.\"), mdx(\"p\", null, \"But have in mind that if the loading screen doesn\\u2019t pose a problem for your app, this can still be a valid approach to implement. I personally like this solution because, unlike with the SSR with (re)hydration approach, this one is more simple to maintain, because it doesn\\u2019t require two separate app builds.\"), mdx(\"p\", null, \"Let\\u2019s see how we\\u2019ve implemented the SSR with (re)hydration approach now!\"), mdx(\"h2\", {\n    \"id\": \"ssr-with-rehydration\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"SSR With (Re)hydration\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#ssr-with-rehydration\",\n    \"aria-label\": \"ssr with rehydration permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"For this implementation, we actually used the same services we already used in the prerendering on-demand implementation.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/59cc4aabe91d7ad07c241c019153a36b/d5bfb/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"25.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQY02NYeXJu5sKQoqUxhWvSbh+c+7Qn+NHEyPsNDt/unP4PAv9ePv42seBKT9bl9pSL+1Y9m113c0L+lQkFV5d03mGYsKvJf4J56lzfuEVBp1aUPcjXuN/mcSWC9fOFnRDNj29/qQg83ZJwvjrkzIr+e51pF9uTL9aFn+3LucwwaVezc4dG6CTrqPl+Z1dXPao0f9AdcCtfHa75yZ0vNSFn25JAGlZNuNefe6Up9nxTzPlJRVcZlp+YnTYvoGBxZN6q5NsH5z7rDXnQE/Kgzevb7VNwZ/fnXepMv9CefGHvyqczq691Z17sybq4uOM2w//////8+fPz10+w0v+/f/38/Onj759QLgT8+PHzCwh8/ffv3/fv3798/vrp0+cfP74DAO3D1QBzRqmsAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2144 1nXboEpjsX4LQDTV9Ahex2g\",\n    \"title\": \"max 2144 1nXboEpjsX4LQDTV9Ahex2g\",\n    \"src\": \"/static/59cc4aabe91d7ad07c241c019153a36b/5a190/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png\",\n    \"srcSet\": [\"/static/59cc4aabe91d7ad07c241c019153a36b/772e8/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 200w\", \"/static/59cc4aabe91d7ad07c241c019153a36b/e17e5/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 400w\", \"/static/59cc4aabe91d7ad07c241c019153a36b/5a190/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 800w\", \"/static/59cc4aabe91d7ad07c241c019153a36b/d5bfb/max-2144-1nXboEpjsX4LQDTV9Ahex2g.png 1072w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"But of course, the diagram will be a bit different:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4be88373404f6dc06647e40710e3d45a/a3ebb/max-2666-1k0AxDm4EcpjLaEObzc2uUg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"69%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC70lEQVQ4y6WS60uTARTGn3eW5TXLbDoNo3RaZPOyqVOnaTJN1zDN0bwMNlPRbGlRVlJmQmlZVrQMQSH6UhQRkkjpTOclbyxp5Nq0ixVuQheihCLixF7pL9iBw+E5H37wPOcATtSr0i0ckyoApmJ/kfV4Ir3WCmac4cFcFcGZKQvBTOnmKGtdOllOpkw5BWyTbsWtVD7OR2xa1akQiHW5giiMThow986C7oEnTNcIwdS3HUSAWjzBVGcPcyrSRhiHXjCLEARC5S4DpzLdwFEJjfg9x4H9IR+Lg5HuGdlw00jd1qOgWAnbl3m03b+N9XmE2dFYFrh/xwQq0gZxIGkI/4F8EEoS+qGO16Mw0sTu54fj8HVS6C0v93PPUXB9IZNn4fPSpxXnO6+tAQhvx8UeRHDJ3zaxrnzngFCTMLSRCMyCOdZrNQjqOD1fJeyLVEbMuBNh5dxCmts0N8DVXBYWbcgPCndEwTMaX1Qahgf+To89ExSEg6dVwq1GNlLdoJ6i2ryx+5QCl54rIf6FHqfd65Tjr+tVk6RNH8wkI1xrWhWe5iKuyHpCQpbDUVb4+Pj42202ucliHRwdf8FXi8C7qIFXTba+vEE9ScdyR3WJPvBoLONt3uuX4lunHNefKZ74Xprck3o8B2sL8vkBz4tDRLOnUn9aapOfgYhcPn746Jgg6ofdspu1XL7nqVe14t7Wo4WPNjgsz7+M97zaFINDOQ942n33QiVr/rjQj8CV9vmY1XePnHXtr0oI7T0iDcbS0hJsNhtDRAxRNxatUjZsRfQYNMldKNnZx+oPpljoWgCN5DFU4i4ke/8G/eLijT0J32SJ6DqX6Hq5LY2D9vZ2tjs6bi5fbTqJnWW7nqNa3stUZQ2wb/N+evn62mw9c1jWx+SGzbL6xh0xc7BJCIfgGhud+mvILsUymc0xyGiODtzXKunIa5WcchbIyWiKgvSCIE5xPZWKdJnfnQKmNIYz4vpNiKsP5slb4nVZzcJj/wDxTkHJKMwR5AAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2666 1k0AxDm4EcpjLaEObzc2uUg\",\n    \"title\": \"max 2666 1k0AxDm4EcpjLaEObzc2uUg\",\n    \"src\": \"/static/4be88373404f6dc06647e40710e3d45a/5a190/max-2666-1k0AxDm4EcpjLaEObzc2uUg.png\",\n    \"srcSet\": [\"/static/4be88373404f6dc06647e40710e3d45a/772e8/max-2666-1k0AxDm4EcpjLaEObzc2uUg.png 200w\", \"/static/4be88373404f6dc06647e40710e3d45a/e17e5/max-2666-1k0AxDm4EcpjLaEObzc2uUg.png 400w\", \"/static/4be88373404f6dc06647e40710e3d45a/5a190/max-2666-1k0AxDm4EcpjLaEObzc2uUg.png 800w\", \"/static/4be88373404f6dc06647e40710e3d45a/c1b63/max-2666-1k0AxDm4EcpjLaEObzc2uUg.png 1200w\", \"/static/4be88373404f6dc06647e40710e3d45a/a3ebb/max-2666-1k0AxDm4EcpjLaEObzc2uUg.png 1333w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Before we explain how it all works\\u2026 Remember when we mentioned that the SSR with (re)hydration approach requires us to generate two production builds of our SPA? One that is served to and executed in the browser, and the other one that\\u2019s actually executed on the server? Right, but where are these stored?\"), mdx(\"p\", null, \"The build that will be served to the user\\u2019s browser is no different than the one we used in the previous, prerendering on-demand, approach, and in the same way, we stored it in a simple S3 bucket. Note that, as in any SPA build, this one contains not only JavaScript files, but also CSS files, images, and other static assets that might be required by your site. On the other hand, the SSR build doesn\\u2019t contain all of that, it only contains a single JS file, with minified code in it, and because of this, we decided to bundle it directly into the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR Lambda\"), \". As the file was ~1MB in size, we did not consider this as a possible performance issue. Alright, back to the diagram!\"), mdx(\"p\", null, \"This time, the flow for both users and web crawlers is the same. CloudFront receives and forwards the HTTP request to the API Gateway, which invokes the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \", which then decides whether it must pull the file from the S3 bucket or it must invoke the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR Lambda.\"), \" The routing is simple \\u2014 if the request doesn\\u2019t point to a file (we check for the existence of file extension), \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" will forward the request to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR Lambda\"), \", which will, of course, generate the HTML that needs to be returned to the visitor. And on the other hand, if a static file is being requested, it will just be pulled from the S3 bucket. As mentioned, this is no different from the previously seen prerendering on-demand approach (when a regular user visited the site).\"), mdx(\"p\", null, \"So, what are the results of this approach?\"), mdx(\"h3\", {\n    \"id\": \"the-results-1\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The Results\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#the-results-1\",\n    \"aria-label\": \"the results 1 permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/c0f607e60f2e5d20dfb78566cf093182/7f7f8/max-4792-18wKNO2UhgRt36qZgtdJAZg.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"43.50000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7klEQVQoz4VRi46EIAz0/z/SRzTnA1uUIshDuIB7bC67m500k7Z0Akyr+BEhkcMUpfyP6jEY0tk4jnVdO+fuVuKTRcNK6Zzruq7v+1tSWWuNMed5eu8ZY23bWmvLdFBr1Ktxl8kgoqZphmEwxmitKyICgGVZOOcAgIhCCCmlVkpIdcJPoBX4zlgasNZ6751zDzEibttWujffib3CxVncgQvBlgUAtozjOKSU6c9CCM65UurFr/xsDnFDLmiapnmepwyttff+adg7s7N4xQh4WCOJ9n2XUhJRuemLOM4QZ3yWb1f1UQwiRV5M+NOX5BdbSwz4+SYNvAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 4792 18wKNO2UhgRt36qZgtdJAZg\",\n    \"title\": \"max 4792 18wKNO2UhgRt36qZgtdJAZg\",\n    \"src\": \"/static/c0f607e60f2e5d20dfb78566cf093182/5a190/max-4792-18wKNO2UhgRt36qZgtdJAZg.png\",\n    \"srcSet\": [\"/static/c0f607e60f2e5d20dfb78566cf093182/772e8/max-4792-18wKNO2UhgRt36qZgtdJAZg.png 200w\", \"/static/c0f607e60f2e5d20dfb78566cf093182/e17e5/max-4792-18wKNO2UhgRt36qZgtdJAZg.png 400w\", \"/static/c0f607e60f2e5d20dfb78566cf093182/5a190/max-4792-18wKNO2UhgRt36qZgtdJAZg.png 800w\", \"/static/c0f607e60f2e5d20dfb78566cf093182/c1b63/max-4792-18wKNO2UhgRt36qZgtdJAZg.png 1200w\", \"/static/c0f607e60f2e5d20dfb78566cf093182/29007/max-4792-18wKNO2UhgRt36qZgtdJAZg.png 1600w\", \"/static/c0f607e60f2e5d20dfb78566cf093182/7f7f8/max-4792-18wKNO2UhgRt36qZgtdJAZg.png 2396w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The interesting this is that, even though we\\u2019ve managed to resolve the SEO compatibility issue with the previously shown prerendering on-demand approach, we did experience slow page load speed, which can be very bad UX-wise. And unfortunately, with the SSR with (re)hydration approach, it\\u2019s no different.\"), mdx(\"p\", null, \"While with the prerendering on-demand approach, the users had to stare at the loading screen until the app has been fully initialized, here, they are again waiting for the same amount of time, but this time, they are staring at a blank screen, waiting for the backend to return the SSR HTML.\"), mdx(\"p\", null, \"Why the wait you might ask yourself? Well, it\\u2019s pretty logical. It\\u2019s because all of the processing that was previously happening in the user\\u2019s browser (behind the loading overlay) is now happening on the backend, inside of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR Lambda\"), \"function. More importantly, out of the box, server-side rendering is a resource-intensive task, so it takes time to generate the whole HTML document. Pair that with the additional latencies that the function cold starts might add, and you\\u2019re guaranteed to have a bad time.\"), mdx(\"p\", null, \"When you look at it, now that the user is staring at the blank screen instead of a nice loading overlay we had before, we\\u2019ve actually managed to make the UX even worse!\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"320px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4a09a99e0a70da331f43a9c4e6991886/cb69c/max-640-0ptcJGCfC4L0SBS4T.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"57.00000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAABzo0UVQtin//EABsQAAIBBQAAAAAAAAAAAAAAAAECAAMQERJC/9oACAEBAAEFAnOGqG3LmaLP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAQIQEf/aAAgBAwEBPwFjs//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/ASf/xAAaEAACAgMAAAAAAAAAAAAAAAAAARAxInGR/9oACAEBAAY/AsRVyVoo/8QAHBABAAIBBQAAAAAAAAAAAAAAAQARMRAhQXHB/9oACAEBAAE/IcojoHItoaXv7iJfiCg9T//aAAwDAQACAAMAAAAQGD//xAAWEQADAAAAAAAAAAAAAAAAAAABECH/2gAIAQMBAT8QqK//xAAXEQADAQAAAAAAAAAAAAAAAAABEBEh/9oACAECAQE/EAmL/8QAHBABAQACAgMAAAAAAAAAAAAAAREAITFBcbHR/9oACAEBAAE/EOAk0pKXFg0ID0ZHrFGzmHxMBI0SAZVVsO33P//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 640 0ptcJGCfC4L0SBS4T\",\n    \"title\": \"max 640 0ptcJGCfC4L0SBS4T\",\n    \"src\": \"/static/4a09a99e0a70da331f43a9c4e6991886/cb69c/max-640-0ptcJGCfC4L0SBS4T.jpg\",\n    \"srcSet\": [\"/static/4a09a99e0a70da331f43a9c4e6991886/e07e9/max-640-0ptcJGCfC4L0SBS4T.jpg 200w\", \"/static/4a09a99e0a70da331f43a9c4e6991886/cb69c/max-640-0ptcJGCfC4L0SBS4T.jpg 320w\"],\n    \"sizes\": \"(max-width: 320px) 100vw, 320px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h2\", {\n    \"id\": \"ssr-html-caching\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"SSR HTML Caching\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#ssr-html-caching\",\n    \"aria-label\": \"ssr html caching permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Even though we\\u2019ve tried to increase the amount of system resources for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR Lambda\"), \" function, that still didn\\u2019t have a positive enough effect on the overall performance. In the end, in order to speed things up, we decided to introduce caching. There were a lot of different solutions we tried, but in the end, we settled with the two I\\u2019m about to explain the following sections.\"), mdx(\"p\", null, \"For both, the only addition to the whole cloud architecture is the database, which we\\u2019ll use to cache the received SSR HTML. It can be any database you like, we decided to go with the MongoDB since we were already relying on it so much. But yes, you can use DynamoDB or Redis for the job, those are definitely good alternatives.\"), mdx(\"h2\", {\n    \"id\": \"solution-1--short-cache-max-age-ttl\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Solution 1 \\u2014 Short Cache Max-Age (TTL)\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#solution-1--short-cache-max-age-ttl\",\n    \"aria-label\": \"solution 1  short cache max age ttl permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"The diagram is almost the same as the one we\\u2019ve seen in the previous section, except now we have a database:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/5bc5378c807b3ef3b02840492473a83e/a3ebb/max-2666-1jgt89rdHIROv2ICABLfsYw.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"69%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADZ0lEQVQ4y6WSfVDTBRjHv79NBwu269bpCvFIA7OIYLCxjbEYLwHCWGQkm+7FZZsnE0wuglxGtish4UxPtNhBR1GedXZUx1VTZMgg2HBmEC/Dcshs/qEZ1+vV6dNt//kfdz53zz33vfve57nnBVhG5D17ATGrvgBwKqZyx9S0vuEqbbL9UvxYHYF0wKThQUngFQXN1qXPLIcHWeEgwHwI4H1O+ZbRsepdU6TaFlAl6wi0E5i2rBcF7IUUaMrzLQsolvcDWAKRCKqSvnVFm888Yd/6Dh9igqv2AbRmrovtrkqVdlSmpmPUdx6Xr8yh3/0t0+chzLjTQASY5V7mpXIPq6ZwhIlov1uJ3CI7BOI+CGQuBMgFZ9P6xEvnMgS/j2ZwtptXcvdU8gTYatAhfHMBJz7rAV9D+HlcGgVq07zYVTAES+5wVM9fEMO0mlAjG4Q1cwgWkQN8Ni9Gy1oR87dPwq9qEHKNL665HxXPlOPmn9dWvN19hA8QghPyOCKwn3/cK9ipcot35AyvJQLz08UsngyE7dKBDUbx2Qxd2qWo78aNIu5ESkLsjPXRzJHqxI2RFSX4/Rdrznvcd74fG0y3Pglh52vg7K0YqT/wwgQ1Vo2dJjnYrneThYb4/ffZdeOzzUYf1RUNlVIYnLdOmuOmtwklgSYlze0RBcDlcoXXw2HNZCDg9vmnUmoVEH6yH/EvF7j0Dv34rcYyz0H1KnCP7F2bVC0sFNh14wOvG7y/WfNcqnYT+BZT6mqvMVkS2Jf/x1zjU4MgIiYYDEYqiM5iflIbHxnd0Db/tKXtR6e5fdbyL4FZ/EES3+0AatSnH7JpPn0kl/cf+85S4srrwazYk/VvcM7tzkk5U1+cFAWFQiEmAqbbX0cP8OrnXmidCxWWj685jR8s2iINvvPkw3qsHWZFPwzZX0HJ+wf0lxCXwwrcUufgyzcVnPYTBSx0dnZGs7urIwqj20CLa5jR9yzCeioMU28IEaB/TIXjvx5AbdkAU1c+wGzeMB/1H/tIzthaxIgIod9x9wNrjl7B7t4QbL0h6J0LjLVnkW3quspC3DeAxgfte8G7/OpD2UxpaxZKWjPXVB1Wdj13WLkP9xLqQ9mskhYRig+mS7cczSd9R+nSPQHzHBsZefPDkDYnJWjaZB1lreKG/wEEMG4maWvN1gAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2666 1jgt89rdHIROv2ICABLfsYw\",\n    \"title\": \"max 2666 1jgt89rdHIROv2ICABLfsYw\",\n    \"src\": \"/static/5bc5378c807b3ef3b02840492473a83e/5a190/max-2666-1jgt89rdHIROv2ICABLfsYw.png\",\n    \"srcSet\": [\"/static/5bc5378c807b3ef3b02840492473a83e/772e8/max-2666-1jgt89rdHIROv2ICABLfsYw.png 200w\", \"/static/5bc5378c807b3ef3b02840492473a83e/e17e5/max-2666-1jgt89rdHIROv2ICABLfsYw.png 400w\", \"/static/5bc5378c807b3ef3b02840492473a83e/5a190/max-2666-1jgt89rdHIROv2ICABLfsYw.png 800w\", \"/static/5bc5378c807b3ef3b02840492473a83e/c1b63/max-2666-1jgt89rdHIROv2ICABLfsYw.png 1200w\", \"/static/5bc5378c807b3ef3b02840492473a83e/a3ebb/max-2666-1jgt89rdHIROv2ICABLfsYw.png 1333w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"So, every time the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" receives the SSR HTML from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR Lambda\"), \", before returning it back to the API Gateway, we also store it in the database. A simple database entry might look something like this:\"), mdx(\"deckgo-highlight-code\", {\n    \"highlight-lines\": \"undefined\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"{\\n  \\\"_id\\\" : ObjectId(\\\"5e144526b5705a00089efb95\\\"),\\n  \\\"path\\\" : \\\"/\\\",\\n  \\\"lastRefresh\\\" : {\\n    \\\"startedOn\\\" : ISODate(\\\"2020-01-07T13:13:48.898Z\\\"),\\n    \\\"endedOn\\\" : ISODate(\\\"2020-01-07T13:13:52.373Z\\\"),\\n    \\\"duration\\\" : 3475\\n  },\\n  \\\"content\\\" : \\\"<!doctype html><html lang=\\\\\\\"en\\\\\\\">...</html>\\\",\\n  \\\"expiresOn\\\" : ISODate(\\\"2020-01-26T16:46:16.876Z\\\"),\\n  \\\"refreshedOn\\\" : ISODate(\\\"2020-01-07T13:13:52.373Z\\\")\\n}\"), \"\\n        \"), mdx(\"p\", null, \"So once the SSR HTML (along with some other data shown in above snippet) has been stored in the database, we just send it back to the API Gateway, along with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cache-Control: public, max-age=MAX_AGE\"), \" header, which will instruct the CloudFront CDN to cache the result for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" seconds.\"), mdx(\"p\", null, \"To get \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" value, we are using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expiresOn\"), \"(the point in time at which the SSR HTML can be considered as expired) that\\u2019s stored in the database. Since this is a date string and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" must be defined in seconds, we just calculate \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expiresOn \\u2014 CURRENT_TIME\"), \". The important thing to note here is that when the\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expiresOn\"), \" is initially set, the value will be a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CURRENT_TIME + 60 seconds\"), \". In other words, calculated\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" will be 60 seconds, so, the following response header will be returned to the CloudFront CDN: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Control: public, max-age=60\"), \".\"), mdx(\"p\", null, \"So, after the initial request, for the next 60 seconds, every time a user hits the same URL in his browser, he will basically experience an instant response (~100ms), since the SSR HTML is served from a CDN edge (and in this case, Lambda functions are never invoked at all).\"), mdx(\"p\", null, \"That\\u2019s awesome, but what happens when the CDN cache expires? Do we again have to wait for the SSR to be generated? No. In that case, the request will reach the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" function again, but now, instead of immediately invoking the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR Lambda\"), \", we will first check if we already have a non-expired cached SSR HTML in the database.\"), mdx(\"p\", null, \"If so, we will just return the received SSR HTML, again with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cache-Control: public, max-age=MAX_AGE\"), \" response header. Note that we\\u2019ve used the database entry\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expiresOn\"), \" value to calculate the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" again, and that this time it doesn\\u2019t have to be 60 seconds, it can be less (and it will be). It can be even 1 second if the SSR HTML was saved to the database 59 seconds ago in one of the previous visitor\\u2019s URL requests. Also note that if the request landed on a CDN edge that doesn\\u2019t have the cached SSR HTML already, the request would still react the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" function.\"), mdx(\"p\", null, \"On the other hand, if we\\u2019ve determined that the received SSR HTML has expired, we will actually do the following. We will first start a process that will update the SSR HTML entry in the database with a fresh SSR HTML and a new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expiresOn\"), \" value, which will be equal to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SSR_HTML_REFRESH_FINISHED_TIME + 60 seconds\"), \". This process will be triggered in an asynchronous fashion, meaning we won\\u2019t be waiting for it to finish because as we\\u2019ve seen, getting the SSR HTML can take some time. Once we\\u2019ve triggered that, we will immediately update the same SSR HTML entry in the database with a new \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expiresOn\"), \" value, to\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CURRENT_TIME + 10 seconds\"), \"(note the short 10-second increment). Once we\\u2019ve saved that, finally, we will return the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"expired\"), \" SSR HTML to the API Gateway, again with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cache-Control: public, max-age=MAX_AGE\"), \" header, only this time the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" will be 10, meaning the CloudFront CDN will cache this expired SSR HTML only for 10 seconds.\"), mdx(\"p\", null, \"In other words, for the next 10 seconds, users will receive an expired version of the SSR HTML from the CloudFront CDN. After that, the cache will again expire, and at that point in time, we will definitely have a fresh SSR HTML (which was refreshed in the mentioned asynchronous process) ready to be served. The only thing to note here is that after the 10-second CDN cache has expired, the new\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" of the served fresh SSR HTML will depend on the received \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"expiresOn\"), \" received from the database (equal to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"(SSR_HTML_REFRESH_FINISHED_TIME + 60 seconds) \\u2014 CURRENT_TIME\"), \"). It can be really between 0s\\u2014 60s, depending on how much time has passed until the 10-second cache expiration and the first request that comes after it. And if more than 60 seconds has passed, the process will again repeat, meaning a 10-second \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" will again be returned, and a new asynchronous SSR HTML refresh process will be triggered.\"), mdx(\"h3\", {\n    \"id\": \"results\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Results\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#results\",\n    \"aria-label\": \"results permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"And that\\u2019s pretty much the whole flow. Performance-wise, most of the time, users will receive the initial HTML in their browsers at ~100ms. The exceptions are cases in which the CDN cache has expired, and the SSR HTML needs to be returned from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" first, in which the latency can jump to 200ms \\u2014 400ms, and to 800ms \\u2014 1200ms if we are dealing with function cold starts. Not bad if you ask me!\"), mdx(\"p\", null, \"On the other hand, one of the issues of this approach is that if there is no SSR HTML in the database at all (not even an expired one), then the user will have to wait for the SSR HTML generation process to finish. There is no way around it because we just don\\u2019t have anything to return to the user. Which means that he will have to wait for 1s \\u2014 4s in order for the SSR HTML to be returned, and even 4s\\u20137s seconds if cold starts are happening in the background.\"), mdx(\"p\", null, \"But note that this happens only once per URL, so it\\u2019s not super frequent and might not be that big of a deal. And to reduce the added latency caused by the cold starts, you could try to utilize the recently introduced \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://aws.amazon.com/about-aws/whats-new/2019/12/aws-lambda-announces-provisioned-concurrency/\"\n  }, \"provisioned concurrency\"), \". I must say we did not try it, but it\\u2019s probably worth checking out if this is causing you issues. Additionally, if possible, you can even request some pages in advance if you want to avoid generating SSR HTML on the user\\u2019s actual request.\"), mdx(\"p\", null, \"Although a nice advantage of this approach is that you don\\u2019t have to do any cache invalidation manually (because the caches expire quickly), you have to note that the API Gateway and Lambda functions will get invoked often, which needs to be taken into consideration, as it might an impact on the overall cost.\"), mdx(\"p\", null, \"This is basically the reason why we started to think more about how we can avoid the API Gateway and Lambda function invocations, and how we can offload as much traffic as possible to the CDN. The first thought that naturally comes to mind is the longer \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" value.\"), mdx(\"h2\", {\n    \"id\": \"solution-2--long-cache-max-age-ttl\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Solution 2 \\u2014 Long Cache Max-Age (TTL)\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#solution-2--long-cache-max-age-ttl\",\n    \"aria-label\": \"solution 2  long cache max age ttl permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"The architecture for this solution stays the same.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4179ac4a0f5f65271c4cabff3c2be1d0/a3ebb/max-2666-1VPizmqHRc0e1vfxIPlu3IQ.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"69%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADZ0lEQVQ4y6WSa0ybBRSG36/dCnW0MTVSZSy4CXOKCIWWUkptBwgMSsWJg24tHWCLA2EbipDVDWczNxy4S4ZTCKibgWxmCdMQYwe0XAMt61xALh/oKqN2PzY34m2Jcce0//aPZCc5OXmTN8/JuQCrCPVrVxHy5GUAF0IKyqdnDHVLtK3qt6znawikB6aMT8nY95Q0VxM/uxoeUjIcAHMOwOe8vB1j40V7pkmzi9VE6wlUAcyYN0lYawaxDWr3qoBSRS+AFRBJoMnu2Zi5/cqL1p0fCyEl2KufQFPixtDOwlh5a0FsPMbcQ1i8MY9e5w9Mzwhh1hkHIqBU4WL25Y1wKjNGmYD2OFVIy7RCJO2BKMUOluxob9gUeX0gQfTHWAJvd+la/t4CgQg7jXr47/yKs998BaGO8MuEPAgsjnNhT/ogzGnDQb1wVQpTOKEyxQFL4iDMEhuEXEFIMWdNyD9umbCwTswveXP948h/NQ93/vKt+ajzlBAgeCcV64jAfeMFl6hC45SWpw5vIALz87UkQQoIu+X9m0ukfQn6uOtB3+3bmfzJmIjQWctziaNFkVsCK4rweK5VDo04H/w47oi3vARx2/vg7c8frT1cNkn1heOXSAGu/WS02Bh28DGrfmKuscRNNZmDOeQH70h36bqZXWIZ26Ci+b0SFnw+X3zL79dNsazT7ZmOqVZC3HUQYe+k2w02w8Td+tyRo9pw8E/t3xBVJM4QWfUT/YeMrnsWtV3TYoLQbIoNd5VEy9gDW/+cr3/ZASJivF5voIKoD4vTxWGB0U0tC6+Ym39qL/tkznyPwNyckoV12oBK7aWnq3QXn00T/Mt9sBK59pY3KbS79gPewNupMVdqs6KCoOXlZSYApv++Dx7g0GU3DJ1L+W91+dotXy9XBRoMONSwnGlBqbIXxuTvoBLcB/0txqJfibvaVHz7oZLXcjadg7a2tmB2drQGYXQfaO4bZkznl1Fx0Y+yLh8CwMkxNT79/TCqc/uZmrx+ZvvmhaD/zHkFU3VMioAQe2wPP7Du9A28e8GHfd0+mDqWmIpzN7nlXyxxgC+B+CEUf+Z9yK89nszkNCUhuylxfeEJVcfrJ1QH8CihPZ7MyT4mQdbRePmO01vJ0Jqz8khAtW0Lo2h8BvLGqAhdc0prbpO07n8N7W4bUP4emwAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 2666 1VPizmqHRc0e1vfxIPlu3IQ\",\n    \"title\": \"max 2666 1VPizmqHRc0e1vfxIPlu3IQ\",\n    \"src\": \"/static/4179ac4a0f5f65271c4cabff3c2be1d0/5a190/max-2666-1VPizmqHRc0e1vfxIPlu3IQ.png\",\n    \"srcSet\": [\"/static/4179ac4a0f5f65271c4cabff3c2be1d0/772e8/max-2666-1VPizmqHRc0e1vfxIPlu3IQ.png 200w\", \"/static/4179ac4a0f5f65271c4cabff3c2be1d0/e17e5/max-2666-1VPizmqHRc0e1vfxIPlu3IQ.png 400w\", \"/static/4179ac4a0f5f65271c4cabff3c2be1d0/5a190/max-2666-1VPizmqHRc0e1vfxIPlu3IQ.png 800w\", \"/static/4179ac4a0f5f65271c4cabff3c2be1d0/c1b63/max-2666-1VPizmqHRc0e1vfxIPlu3IQ.png 1200w\", \"/static/4179ac4a0f5f65271c4cabff3c2be1d0/a3ebb/max-2666-1VPizmqHRc0e1vfxIPlu3IQ.png 1333w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"So, users will receive SSR HTML from the CDN whenever possible. If not, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" will get invoked by the API Gateway, and the SSR HTML will be returned, be it directly from the database, or by generating it on the spot (as seen, this happens when the SSR HTML does not exist, not even an expired one).\"), mdx(\"p\", null, \"The only difference is that, as mentioned, we are sending much longer \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MAX_AGE\"), \" value in the response headers, e.g. a whole month (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cache-Control: public, max-age=2592000\"), \"). Note that if the request reaches the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \" and we determine that we have an expired SSR HTML cache in the database, we still respond with the short \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cache-Control: public, max-age=10\"), \"response header. This didn\\u2019t change.\"), mdx(\"p\", null, \"With this approach, we have much less Lambda function invocations, because most of the time, users will hit the CDN, which means users won\\u2019t experience cold start latencies that much, and we can also worry a bit less about Lambda functions generating a lot of costs. Nice!\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"471px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/b653bba7fb278b23c05421d83216e3f8/1f09d/max-942-14UGX1_XcJnlqgcAI1TofyQ.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.49999999999999%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdElEQVQozwXBWW/SAAAA4CYIwrKNlh5I7/uAlpZCYbSUG8Yxjo5DJC443ZybJotHjNkP8HUPS4zR+Oae/QdGE+Pr/El+HxAHSRREMJTGuSKXbohSXmPYgqzKRjPjzgx3li7PRKtPShWUsnYTHMGXknQeJbJQUgOgBCcJsiAYutV2Sj0UxPq53Mez535twufHajEQ8yPW2E+JHoxn44icYh2YMFHSxFkHQJIamaJ4wei0571a31UzR/Xa1Xp10ByTeld2xoTs40oNYctxLA0mNZiwdlEFSWl6pgSk86NSbm+v3JsHx6dHF5PufOGWXgfjbiOg9L7qTLhsjzMHpNZCqQJMWhhbTIkuLRZ4SgIenV7P52eN9nIyPZsO1543Xler57OV402lbMfyH9qNx3Zzo1dWnN7FmBKX3ZfNFkVnoF0csGtP/dosl2/kKqsEwqeNerMyDIIXitFmeNv0FnJhJJstXnUJOovRDi56aJK7f28nHIEAmMi55Y5j78EIj6d4yxkguGG7C7+xoGjNLI4Esy8xclrM4Ekao2xS9uEEEYvEoxEIoKSa7+/rihaLggwluZUJmOBL3kzT3O0tRFB8Wa/zlKTIOZoxwJSJc0U4QYRD2+HQDiAaB9XqUBUVKMEgEF6tB3GIPz55e3N98+HN+/NX7y4vr9arjSqbopSXVYfhbZYzCEJBUQ6AULXbHBiqAUGkJlkMk9mKYSfPLv7d3f358/f2++3vn7++ff086fiHg2HQ8DKqUS7Yo1al7RWBcCiyPJwbmhEORSEQ24qB0cg2AmH4A4qlhM3m5acvP4LpvGjry+UTlRaafqPX7g+aXrfi/AcIlIZ7WAEg7AAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 942 14UGX1 XcJnlqgcAI1TofyQ\",\n    \"title\": \"max 942 14UGX1 XcJnlqgcAI1TofyQ\",\n    \"src\": \"/static/b653bba7fb278b23c05421d83216e3f8/1f09d/max-942-14UGX1_XcJnlqgcAI1TofyQ.png\",\n    \"srcSet\": [\"/static/b653bba7fb278b23c05421d83216e3f8/772e8/max-942-14UGX1_XcJnlqgcAI1TofyQ.png 200w\", \"/static/b653bba7fb278b23c05421d83216e3f8/e17e5/max-942-14UGX1_XcJnlqgcAI1TofyQ.png 400w\", \"/static/b653bba7fb278b23c05421d83216e3f8/1f09d/max-942-14UGX1_XcJnlqgcAI1TofyQ.png 471w\"],\n    \"sizes\": \"(max-width: 471px) 100vw, 471px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"But now we have to think about cache invalidation. How do we tell the CloudFront CDN to clear the SSR HTML it possesses, so a new one can be fetched from the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Web Server Lambda\"), \"? This happens very often, for example, when an admin makes changes to an existing page via the Page Builder and publishes it.\"), mdx(\"p\", null, \"When you think about it, it should be pretty straight-forward, right? Every time an admin user makes changes to an existing page and publishes it, we can just programmatically invalidate the cache for the page\\u2019s URL and that\\u2019s it, right?\"), mdx(\"p\", null, \"Well, actually, that\\u2019s only a part of the complete solution. We still have some other key events on which the CDN cache should be invalidated.\"), mdx(\"p\", null, \"For example, our Page Builder app supports many different page elements that you can drag onto your page, one of which is the element that lets you embed forms from our Form Builder app. So, you add a form to your page, publish the page, and it\\u2019s all good. But what if someone makes changes on the actual form, for example, adds additional fields to it? If that happens, site users must be able to see these changes (the SSR HTML must contain them). So, the \\u201Cjust invalidate on page publish\\u201D idea will not be enough here.\"), mdx(\"p\", null, \"But there\\u2019s more! Let\\u2019s say an admin user makes changes to the site\\u2019s main menu. Since the menu can be seen on every page basically, does that mean we should invalidate the cache for all pages that contain it? Well, unfortunately, yes, there is no other way around it. But before we do that, is there anything we should know about cache invalidation pricing?\"), mdx(\"p\", null, \"The total number of pages that contain the menu could vary from 10 to 20 pages for smaller sites, but for larger ones, we could easily have hundreds or even thousands of pages! So, this could force us to create a lot of cache invalidation requests to the CDN, and if you check out the CloudFront\\u2019s \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://aws.amazon.com/cloudfront/pricing/\"\n  }, \"pricing page\"), \", we can see that these aren\\u2019t cheap:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"No additional charge for the first 1,000 paths requested for invalidation each month. Thereafter, \\\\$0.005 per path requested for invalidation.\")), mdx(\"p\", null, \"No additional charge for the first 1,000 paths requested for invalidation each month. Thereafter, \\\\$0.005 per path requested for invalidation.\"), mdx(\"p\", null, \"As we can see, if we were to implement the basic \\u201Cjust invalidate all pages that contain the menu\\u201D logic, we would probably break out of the free tier very quickly, and basically start paying \\\\$5 for every additional 1,000 invalidations we make. Not good.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"460px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/fce05dcccd34e4b22c7b1be6f4c75d3a/e41a8/max-920-0jm0e9m5Q6gyxB7CQ.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"100%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQEAAwAAAAAAAAAAAAAAAAQCAQMF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAGerr3jVLzCX7E4Ff/EABoQAAMBAQEBAAAAAAAAAAAAAAABAhIDBCH/2gAIAQEAAQUCms9V6Bd4MGFipU0mfGZR/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGhAAAgMBAQAAAAAAAAAAAAAAADEBEWEQIf/aAAgBAQAGPwK8EMnSio94hH//xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhQTFRcZH/2gAIAQEAAT8h+awjau4syh8lMghpY+8S+NexllYJQUhI6wT/2gAMAwEAAgADAAAAEFsPfv/EABgRAAIDAAAAAAAAAAAAAAAAAAABEBEh/9oACAEDAQE/EMm2f//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAgEBPxC6qJj/xAAeEAEAAgEEAwAAAAAAAAAAAAABABEhMUFRkXGh0f/aAAgBAQABPxAQ05eORzFrdoJq4NeJLfZBk5RWVhWiNAlumNgViE6mQqrG/wBjuCFNw7hOAn//2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 920 0jm0e9m5Q6gyxB7CQ\",\n    \"title\": \"max 920 0jm0e9m5Q6gyxB7CQ\",\n    \"src\": \"/static/fce05dcccd34e4b22c7b1be6f4c75d3a/e41a8/max-920-0jm0e9m5Q6gyxB7CQ.jpg\",\n    \"srcSet\": [\"/static/fce05dcccd34e4b22c7b1be6f4c75d3a/e07e9/max-920-0jm0e9m5Q6gyxB7CQ.jpg 200w\", \"/static/fce05dcccd34e4b22c7b1be6f4c75d3a/066f9/max-920-0jm0e9m5Q6gyxB7CQ.jpg 400w\", \"/static/fce05dcccd34e4b22c7b1be6f4c75d3a/e41a8/max-920-0jm0e9m5Q6gyxB7CQ.jpg 460w\"],\n    \"sizes\": \"(max-width: 460px) 100vw, 460px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Because of this, we started to think about alternative ideas and we came up with the following.\"), mdx(\"p\", null, \"If a change in the menu happens, let\\u2019s not invalidate the cache for all pages that contain it. Instead, let\\u2019s check if the page needs to be invalidated only when actually visited. So, every time a user visits a page, we\\u2019ll make a simple HTTP request (triggered asynchronously so it doesn\\u2019t affect the page performance), that will invoke a Lambda function which checks if the CDN cache needs to be invalidated, by checking if the SSR HTML stored in the database has expired, be it because enough time has passed since it was generated, or it was simply marked as expired in one of the key events (for example a menu was updated, or page published). If so, it will just fetch the new SSR HTML and send an invalidation request to the CDN.\"), mdx(\"p\", null, \"This means a couple of things.\"), mdx(\"p\", null, \"First, for every page visit, we\\u2019ll have a Lambda function invocation. But one of the reasons we wanted to try this longer max-age (TTL) approach is to actually avoid that. Unfortunately, it cannot be avoided. The good news is that you can reduce the number of invocations by simply triggering this check less frequently. Trigger it once in one, five, or even ten minutes \\u2014 whatever works best for your case.\"), mdx(\"p\", null, \"Second, invalidating CDN cache takes time, so the fresh SSR HTML will arrive anywhere from 5 seconds to 5 minutes, or even later, depending on the current status of the CDN. In most cases, it will be pretty fast, 5\\u201310 seconds on average is what we\\u2019ve experienced.\"), mdx(\"h3\", {\n    \"id\": \"trigger-invalidation-selectively-with-custom-html-tags\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Trigger Invalidation Selectively With Custom HTML Tags\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#trigger-invalidation-selectively-with-custom-html-tags\",\n    \"aria-label\": \"trigger invalidation selectively with custom html tags permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"As seen, the \\u201Cmenu-changed\\u201D event we\\u2019ve seen is an important event that must trigger the cache invalidation for not just one page. But, let\\u2019s say we\\u2019re updating a secondary menu that\\u2019s located only on a small number of pages. Once updated, we definitely don\\u2019t want to mark all of our site\\u2019s pages as expired, right? So naturally, the question that comes up is: is there a way we can be more efficient and only invalidate cache for pages that actually contain the updated menu?\"), mdx(\"p\", null, \"Because of this issue, we decided to introduce HTML tagging. In other words, we utilize our own custom\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ssr-cache\"), \" HTML tag to purposely tag different HTML sections / pieces of UI.\"), mdx(\"p\", null, \"For example, if you are using the\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Menu\"), mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/webiny/webiny-js/blob/master/packages/app-page-builder/src/render/components/Menu.tsx#L35\"\n  }, \" React component\"), \" (provided by our Page Builder app) to render menus on your pages, besides the actual menu, the component will also include the following HTML when it gets rendered:\"), mdx(\"deckgo-highlight-code\", {\n    \"highlight-lines\": \"undefined\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"<ssr-cache data-class=\\\"pb-menu\\\" data-id=\\\"small-menu\\\" />\"), \"\\n        \"), mdx(\"p\", null, \"A page can have multiple different tags like this (you can also introduce your own), and all of them will be stored in the database when doing SSR HTML generation. Let\\u2019s take a look at an updated database entry:\"), mdx(\"deckgo-highlight-code\", {\n    \"highlight-lines\": \"undefined\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"{\\n  \\\"_id\\\": ObjectId(\\\"5e2eb625e2e7c80007834cdf\\\"),\\n  \\\"path\\\": \\\"/\\\",\\n  \\\"cacheTags\\\": [\\n    {\\n      \\\"class\\\": \\\"pb-menu\\\",\\n      \\\"id\\\": secondary-menu\\\"\\n    },\\n    {\\n      \\\"class\\\": \\\"pb-menu\\\",\\n      \\\"id\\\": \\\"main-menu\\\"\\n    },\\n    {\\n      \\\"class\\\": \\\"pb-pages-list\\\"\\n    }\\n  ],\\n  \\\"lastRefresh\\\": {\\n    \\\"startedOn\\\": ISODate(\\\"2020-01-27T10:06:29.982Z\\\"),\\n    \\\"endedOn\\\": ISODate(\\\"2020-01-27T10:06:36.607Z\\\"),\\n    \\\"duration\\\": 6625\\n  },\\n  \\\"content\\\": \\\"<!doctype html><html lang=\\\\\\\"en\\\\\\\">...</html>\\\",\\n  \\\"expiresOn\\\": ISODate(\\\"2020-02-26T10:06:36.607Z\\\"),\\n  \\\"refreshedOn\\\": ISODate(\\\"2020-01-27T10:06:36.607Z\\\")\\n}\"), \"\\n        \"), mdx(\"p\", null, \"All of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ssr-cache\"), \" HTML tags that are contained in the received SSR HTML are extracted and saved in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cacheTags\"), \" array. This enables us to query the data more easily later down the road.\"), mdx(\"p\", null, \"As we can see, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cacheTags\"), \" array contains three objects, where the first one is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"{ \\u201Cclass\\u201D: \\u201Cpb-menu\\u201D, \\u201Cid\\u201D: \\u201Csmall-menu\\u201D }\"), mdx(\"em\", {\n    parentName: \"p\"\n  }, \". \"), \"This simply means that the SSR HTML contains a Page Builder menu (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pb-menu\"), \"), that has the ID \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"secondary-menu\"), \"(the ID here actually is represented with menu\\u2019s unique \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"slug\"), \", which is set via the admin UI).\"), mdx(\"p\", null, \"There are more tags like this, for example \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pb-pages-list\"), \". This tag simply signifies that the SSR HTML contains Page Builder\\u2019s \\u201Clist of pages\\u201D page element. It exists because if you\\u2019re having a list of pages on your page, and a new page is published (or an existing one is modified), the SSR HTML can be considered as expired because the list of pages that was once on the page might have been affected by the newly published page.\"), mdx(\"p\", null, \"So now that we understand the purpose of these tags, how do we utilize them? Pretty simple actually. To make things easier for developers, we\\u2019ve actually created a small \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SsrCacheClient\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/webiny/webiny-js/blob/master/packages/http-handler-ssr/src/Client.ts\"\n  }, \"client\"), \", with which you can trigger invalidations either by specific URL path or by passed tags, using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"invalidateSsrCacheByPath\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"invalidateSsrCacheByTags\"), \" methods, respectively. You would use these when the SSR HTML needs to be marked as expired and cache invalidated, in key events you define.\"), mdx(\"p\", null, \"For example, when a menu has changed, we execute the following (\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/webiny/webiny-js/blob/master/packages/api-page-builder/src/plugins/useSsrCacheTags.ts#L91\"\n  }, \"full code\"), \"):\"), mdx(\"deckgo-highlight-code\", {\n    \"highlight-lines\": \"undefined\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"await ssrApiClient.invalidateSsrCacheByTags({\\n    tags: [{ class: \\\"pb-menu\\\", id: this.slug }]\\n});\"), \"\\n        \"), mdx(\"p\", null, \"And when a new page was published (or existing one deleted), all pages that contain the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pb-pages-list\"), \" page element need to be invalidated (\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/webiny/webiny-js/blob/master/packages/api-page-builder/src/plugins/useSsrCacheTags.ts#L47\"\n  }, \"full code\"), \"):\"), mdx(\"deckgo-highlight-code\", {\n    \"highlight-lines\": \"undefined\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"await ssrApiClient.invalidateSsrCacheByTags({\\n    tags: [{ class: \\\"pb-pages-list\\\" }]\\n});\"), \"\\n        \"), mdx(\"p\", null, \"Base Hoola AI apps, like Page Builder or Form Builder, are already utilizing both \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ssr-cache\"), \" tags in the React components and the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SsrCacheClient\"), \" client on the backend, so you don\\u2019t have to worry much about this. And if you\\u2019re doing custom development, in the end, it basically comes down to recognizing the events that must trigger the SSR HTML invalidation, placing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ssr-cache\"), \" tags in your components and using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SsrCacheClient\"), \" client appropriately.\"), mdx(\"h3\", {\n    \"id\": \"results-1\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Results\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#results-1\",\n    \"aria-label\": \"results 1 permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"The solution with long-lived TTLs is good, but again, it\\u2019s not the ultimate one.\"), mdx(\"p\", null, \"The most significant factor that might tell you if this is a good approach for you, is the amount of changes that are happening on your site. If changes (specific events that must trigger SSR HTML invalidation) are happening very often, for example, every few seconds or minutes, I would definitely not suggest this approach because cache invalidations would happen practically all the time, and that somehow defeats the purpose. In that case, you might be better off with the Solution 1 we\\u2019ve seen earlier. But analysing and testing your app is the key.\"), mdx(\"p\", null, \"Also, if a certain page is not visited for a long time, and its SSR HTML was marked as expired in the meantime, the user that first visits it will still see the old page. Because if you\\u2019ll remember, in cases where a key event triggered the SSR HTML invalidation for several pages (like the \\u201Cmenu changed\\u201D event), the actual cache invalidation is triggered by users actually visiting the page, instead of us sending a massive amount of cache invalidation requests to the CloudFront and spending money while doing it.\"), mdx(\"p\", null, \"But overall, considering the stellar speed benefits and asynchronous cache invalidation that this solution offers, we think this is a good approach to utilize.\"), mdx(\"p\", null, \"We\\u2019ve actually made this the default caching behavior for every new Hoola AI project, but you can basically switch to the Solution 1 by easily removing a couple of plugins. Be sure to check our \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.hoola.ai/\"\n  }, \"docs\"), \" if you want to find out more information on that.\"), mdx(\"h2\", {\n    \"id\": \"conclusion\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Conclusion\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#conclusion\",\n    \"aria-label\": \"conclusion permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"Did you make it to the end? Woah, I admire you!\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"474px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/f75a403f0175c4657dacae43bc478a3f/08ff2/max-948-0RBBel2f-xDeSLc-V.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"85.50000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQDBQb/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAaubtFm+qZrODQFQP//EABsQAQACAwEBAAAAAAAAAAAAAAIBAwAEETIz/9oACAEBAAEFAthoYbXKB4d1KyZh8h9gfJZR5//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EAB4QAAICAQUBAAAAAAAAAAAAAAABAhExECFBUWFx/9oACAEBAAY/Am3ClwxLF9s3q/BRjhGC9X9P/8QAHxABAAIBAwUAAAAAAAAAAAAAAQARMSFBUWFxgaGx/9oACAEBAAE/IaHrdBzAQllClSjBybJqhdQzHjgjkjEG+0+jMPE97P/aAAwDAQACAAMAAAAQZCDC/8QAFxEBAQEBAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxADOxn/xAAYEQACAwAAAAAAAAAAAAAAAAABEBEhMf/aAAgBAgEBPxC5Qxf/xAAhEAACAQQABwAAAAAAAAAAAAABEQAhMUFREGFxgbHR8P/aAAgBAQABPxCwgrFueQ9QufGDG0X6hqHLrMcpwHAPZKH3alqhIGgERW7gmYkXCj4dc6fM+ZoT/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"max 948 0RBBel2f xDeSLc V\",\n    \"title\": \"max 948 0RBBel2f xDeSLc V\",\n    \"src\": \"/static/f75a403f0175c4657dacae43bc478a3f/08ff2/max-948-0RBBel2f-xDeSLc-V.jpg\",\n    \"srcSet\": [\"/static/f75a403f0175c4657dacae43bc478a3f/e07e9/max-948-0RBBel2f-xDeSLc-V.jpg 200w\", \"/static/f75a403f0175c4657dacae43bc478a3f/066f9/max-948-0RBBel2f-xDeSLc-V.jpg 400w\", \"/static/f75a403f0175c4657dacae43bc478a3f/08ff2/max-948-0RBBel2f-xDeSLc-V.jpg 474w\"],\n    \"sizes\": \"(max-width: 474px) 100vw, 474px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Jokes aside \\uD83D\\uDE42, I hope I\\u2019ve managed to convey some of our experiences to you, and that you\\u2019ve received some value out of this article.\"), mdx(\"p\", null, \"We\\u2019ve learned a lot of different things today. Starting from fundamental concepts of Single Page Applications, their lack of SEO support, and different approaches of rendering on the web, to implementing two of these approaches (that worked best for our Page Builder app) in a serverless environment \\u2014 prerendering on-demand and SSR with (re)hydration. And although the mentioned lack of SEO support has been resolved with both, unfortunately, by default, these approaches do not offer an acceptable performance when it comes to the page load time. Sure, if a loading screen is not an issue for your particular app, then prerendering on-demand might work for you. But if not, SSR with re(hydration) is probably your best choice.\"), mdx(\"p\", null, \"We\\u2019ve also seen that these approaches can be implemented relatively easily in a serverless environment, using just a few of the AWS serverless services \\u2014 S3, Lambda, API Gateway, and CloudFront. Although we don\\u2019t have to manage any of the physical infrastructure for all of this to work, we still have to take into consideration the amount of RAM that we will allocate to the Lambda functions. For basic file serving needs, a minimum of 128MB RAM will suffice, but for doing prerendering on-demand or SSR, which are resource-intensive tasks, we must allocate more. Allocate carefully and test appropriately, since this can impact your monthly costs. Make sure to check out the pricing pages for each service, and try to do estimates based on your monthly traffic.\"), mdx(\"p\", null, \"And finally, to tackle slow SSR generation and function cold starts, we utilized CDN caching, which can make a significant difference in terms of performance and cost. Depending on what works best for our case, we can do caching with either short or long max-age / TTLs. If we choose to go with the latter, manual cache invalidation will be required. And if there will be a lot of those because the content is too dynamic, you might want to rethink your strategy and see if using shorter max-age (TTL) values is a better solution.\"), mdx(\"p\", null, \"As always, there is no silver bullet for any problem and the topic we covered today is certainly a good example of that. Trying out different things is the key, it will help you in finding what works best for your particular case.\"), mdx(\"p\", null, \"Oh, and by the way, the good news is that, if you don\\u2019t want to torture yourself and want to avoid implementing everything from scratch, you can give Hoola AI a try! You can even choose between the two different SSR HTML caching approaches we\\u2019ve shown, by applying a specific set of plugins. We like to keep it flexible. \\uD83D\\uDE42\"), mdx(\"p\", null, \"Feel free to check it out if you\\u2019re interested! And do catch us on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.hoola.ai/slack\"\n  }, \"Slack\"), \" if you have any questions, we would be glad to answer them!\"), mdx(\"hr\", null), mdx(\"p\", null, \"Again, I hope I\\u2019ve managed to explain the approaches we\\u2019ve tried at Hoola AI, but if you have a question about anything, feel free to ask! I would also like to hear your opinion on the topic, so if you have something to share, please do!\"), mdx(\"hr\", null), mdx(\"p\", null, \"Thanks for reading! My name is Adrian and I work as a full-stack developer at \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.hoola.ai/\"\n  }, \"Hoola AI\"), \". In my spare time, I like to write about my / our experiences with some of the modern frontend and backend (serverless) web development tools, hoping it might help other developers in their everyday work. If you have any questions, comments or just wanna say hi, feel free to reach out to me via \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.twitter.com/doitadrian\"\n  }, \"Twitter\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"author":"adrian","slug":"blog/serverless-side-rendering-e1c0924b8da1","title":"Serverless Side Rendering — The Ultimate Guide","description":"Learn how we’ve achieved great SEO support for every Hoola AI website and made them run super-fast, using SSR in a serverless environment.","tags":["Serverless","Single Page Applications","AWS","SEO","CMS"],"date":"February 05, 2020","featureImage":{"publicURL":"/static/f0b0f07cec56b17482222ddb0234d255/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png","childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoUlEQVQozwXBWVMSAQAA4P0XTTM9pDUd5hCggpocWqgcgiD3sawHh+CBCAOIiHIbIrgrhyissMSlnGIeU2QPPlTTa7+n7wMm0hZhaUvdcKtrbmnZNYVu0bNuNrolq/oN32DtXWy+E1K193nFvdH4JgfbninssYs+TilIz7iAKdQsKtsV9W3phZtftI8er5KRDS7mYKE2ad2jaAXmrzzK+g4r7xhLWT5lbbyKR9AM81uHnIoXoKdWZzEHB7PPYHY+ZqbFV9jopuzSxczZuXk7C91QNgOSkkN8YYc6AcaZRXUdhu7C8uvQXM0FUBGjpRlfb8O2u4S/m3Z9Pwk9YsvNiKGTCP/ueH41fX9anx8Lpnb0+O+l8/7M0c2k/301dGFxxwPQknoqomNmlmUVJ1hzgldO2YWLi9kmUMd4wSe8TSt+nC/cH/CKVh5mlV8FKKcmZcOvbHuFdSdAT2pJUXAIhhinZm19X9P0Gq+DazewpoWoOknTQ9X0kLZ0wzs/keXGIdg4IEQW8LCGX7Wy8gbgTVD1KqgYTi6Mppam87rpnJZ6qhk+WcKl1oYKu+SsiVfWgk2z+NI2ga7iIypCVMUsrPHKK4xzHfAiJH8Pg5Q0RE2D41noY05DTs1bb6Lrt0eUjEVetbGzOhoiGYSV5DiIg9VEGOJUTDNVM7O8ATz3Cwdg+UhKOYDIcAdzgzHJu0ORvuaTfHELKmaw7uJkjDRMTy9Z3gb5xJQWH5UxCivMopGW0wNPXeynbl5/REhOyPFRUX9EQDgSExE+ISEhZ6CRMxUuJqRnlJMFPQkR9SGLz7wC/DHILOk/nELAyxC3N8Tt8bOJcSEtKyXG50gpEbMoG0oK+46kk6XF1zFZb4A1jkrHMoreILcnMPtkl0NKqylZ6D+UOC8UUHZBvwAAAABJRU5ErkJggg==","aspectRatio":1.9047619047619047,"src":"/static/f0b0f07cec56b17482222ddb0234d255/ee604/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png","srcSet":"/static/f0b0f07cec56b17482222ddb0234d255/69585/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png 200w,\n/static/f0b0f07cec56b17482222ddb0234d255/497c6/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png 400w,\n/static/f0b0f07cec56b17482222ddb0234d255/ee604/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png 800w,\n/static/f0b0f07cec56b17482222ddb0234d255/f3583/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png 1200w,\n/static/f0b0f07cec56b17482222ddb0234d255/5707d/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png 1600w,\n/static/f0b0f07cec56b17482222ddb0234d255/0ef64/max-4800-1wJmWlW5rkKTBJm2qMZqvcg.png 2400w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"blog/serverless-side-rendering-e1c0924b8da1"}},"staticQueryHashes":["144257237"]}