{"componentChunkName":"component---src-components-blog-blog-template-js","path":"/blog/simplifying-your-application-state-management-with-Recoil","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var n = Object.getOwnPropertySymbols(e); for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (-1 !== e.indexOf(n)) continue; t[n] = r[n]; } return t; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"slug\": \"blog/simplifying-your-application-state-management-with-Recoil\",\n  \"title\": \"Simplifying your application state management with Recoil\",\n  \"description\": \"Switching Hoola AI's Page Builder Application state management to Recoil due to redux being hard to maintain and debug.\",\n  \"tags\": [\"Recoil\", \"Redux\", \"Page Builder\", \"JavaScript\"],\n  \"featureImage\": \"./assets/simplifying-your-application-state-management-with-Recoil/cover.png\",\n  \"author\": \"bruno\",\n  \"date\": \"2020-11-23T00:00:00.000Z\"\n};\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\nvar ExternalLink = makeShortcode(\"ExternalLink\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In Hoola AI we have the Page Builder Application that was built with help of redux as global state management. We decided to switch our Page Builder to Recoil due to redux being hard to maintain and debug. But before we dive into how we did it, what were the issues and how we managed to make everything work with our code structure, a bit info about ...\"), mdx(\"h2\", {\n    \"id\": \"recoil\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Recoil\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#recoil\",\n    \"aria-label\": \"recoil permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"It is a, fairly new, library for managing global state - like redux. It is being developed by people at Facebook and it is still in an experimental state, so you can expect things will change.\"), mdx(\"h2\", {\n    \"id\": \"introduction\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Introduction\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#introduction\",\n    \"aria-label\": \"introduction permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"A recoil state is contained within an atom. The official description says an atom is \\u201Ca representation of the state\\u201D. You can have multiple atoms, to split state, e.g. page, content, UI, etc., which helps when structuring the actual state. It can lead to some problems though, but we will come to that later.\"), mdx(\"p\", null, \"Recoil is used via hooks, so you can not use it in your class components. If you would like to use Recoil, and you have class components, you need to wrap your class component in a function one and pass the Recoil state and state set function.\"), mdx(\"h2\", {\n    \"id\": \"basic-recoil-api-info\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Basic Recoil API Info\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#basic-recoil-api-info\",\n    \"aria-label\": \"basic recoil api info permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"h3\", {\n    \"id\": \"atom\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Atom\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#atom\",\n    \"aria-label\": \"atom permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"\\u201CAn atom represents a state in Recoil\\u201D, says the official documentation about it. Look at it as part of the global state object from redux. Of course, you can put everything in a single atom, but we reckon that is not the intended use. The main properties you need when instantiating an atom are \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"key\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"default\"), \", where the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"key\"), \" is a unique string that identifies an atom internally in Recoil and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"default\"), \" is the initial value of the state. You can create an atom without a default value, of course, just try not to. \", mdx(ExternalLink, {\n    href: \"https://recoiljs.org/docs/api-reference/core/atom\",\n    mdxType: \"ExternalLink\"\n  }, \"Read more...\")), mdx(\"h3\", {\n    \"id\": \"selector\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Selector\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#selector\",\n    \"aria-label\": \"selector permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"\\u201CSelectors represent a function, or derived state in Recoil\\u201D, as it states in the official documentation. When you are creating the selector, you need to define the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"key\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get\"), \" properties, where \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"key\"), \" is a unique string that identifies the selector internally and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get\"), \" is a function that returns a value (it can be an async function as well). We explain that more later on. \", mdx(ExternalLink, {\n    href: \"https://recoiljs.org/docs/api-reference/core/selector\",\n    mdxType: \"ExternalLink\"\n  }, \"Read more...\")), mdx(\"h3\", {\n    \"id\": \"selector-family\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Selector Family\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#selector-family\",\n    \"aria-label\": \"selector family permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"This function is used to read the state with help of a passed param. Basically, you can pass it an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id\"), \" and return only the part of the state based on that value. When you are creating the selectorFamily you need to define the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"key\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get\"), \" properties, where the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"key\"), \" is a unique string that identifies the selector family internally in Recoil and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get\"), \" is a function that accepts an argument which you passed into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"selectorFamily\"), \" and it returns a function that is exactly the same as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"get\"), \" in the plain selector. You can use the sent value to search the state or do whatever you need to do. \", mdx(ExternalLink, {\n    href: \"https://recoiljs.org/docs/api-reference/utils/selectorFamily\",\n    mdxType: \"ExternalLink\"\n  }, \"Read more...\")), mdx(\"h3\", {\n    \"id\": \"userecoilstateatom--selector\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"useRecoilState(atom | Selector)\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#userecoilstateatom--selector\",\n    \"aria-label\": \"userecoilstateatom  selector permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"A hook that returns a tuple of current atom, or selector, value and a setter function for that atom or selector, as built-in React\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useState\"), \". Note that if you are calling this hook with a selector variable, it must be a writable selector - have \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"set\"), \" property defined. \", mdx(ExternalLink, {\n    href: \"https://recoiljs.org/docs/api-reference/core/useRecoilState\",\n    mdxType: \"ExternalLink\"\n  }, \"Read more...\")), mdx(\"h3\", {\n    \"id\": \"userecoilvalueatom--selector\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"useRecoilValue(atom | Selector)\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#userecoilvalueatom--selector\",\n    \"aria-label\": \"userecoilvalueatom  selector permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"A hook that returns the current atom or selector value. This hook is intended to use when you only need to read the state, not write to it. \", mdx(ExternalLink, {\n    href: \"https://recoiljs.org/docs/api-reference/core/useRecoilValue\",\n    mdxType: \"ExternalLink\"\n  }, \"Read more...\")), mdx(\"h3\", {\n    \"id\": \"usesetrecoilstateatom--selector\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"useSetRecoilState(atom | Selector)\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#usesetrecoilstateatom--selector\",\n    \"aria-label\": \"usesetrecoilstateatom  selector permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"A hook that returns a setter function for a given atom or selector. Be aware that if you are using the selector must be writable to be able to use this hook. Also, this hook will not subscribe the component to re-render when the value changes. \", mdx(ExternalLink, {\n    href: \"https://recoiljs.org/docs/api-reference/core/useSetRecoilState\",\n    mdxType: \"ExternalLink\"\n  }, \"Read more...\")), mdx(\"h3\", {\n    \"id\": \"useresetrecoilstateatom\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"useResetRecoilState(atom)\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#useresetrecoilstateatom\",\n    \"aria-label\": \"useresetrecoilstateatom permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"A hook that will reset the state to default value given when creating the atom. As the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useSetRecoilState\"), \", this hook will not subscribe the component to re-render when value changes. \", mdx(ExternalLink, {\n    href: \"https://recoiljs.org/docs/api-reference/core/useResetRecoilState\",\n    mdxType: \"ExternalLink\"\n  }, \"Read more...\")), mdx(\"h2\", {\n    \"id\": \"starting-with-recoil\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Starting With Recoil\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#starting-with-recoil\",\n    \"aria-label\": \"starting with recoil permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Install it via package manager:\")), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"bash\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"yarn add recoil or npm install recoil\"), \"\\n        \"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Wrap your code in RecoilRoot component:\")), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"javascript\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const YouAppCodeWrap = () => {\\n  return (\\n    <RecoilRoot>\\n      <YourAppCode />\\n    </RecoilRoot>\\n  );\\n};\"), \"\\n        \"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Create an atom:\")), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"javascript\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const exampleAtom = atom({\\n  key: \\\"example\\\",\\n  default: false,\\n});\"), \"\\n        \"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Use it:\")), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const YourAppCode = () => {\\n  const [exampleValue, setExampleValue] = useRecoilState(exampleAtom);\\n  return <Button onClick={() => setExampleValue(!exampleValue)} active={exampleValue} />;\\n};\"), \"\\n        \"), mdx(\"h2\", {\n    \"id\": \"switching-code-from-redux-to-recoil\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Switching Code From Redux to Recoil\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#switching-code-from-redux-to-recoil\",\n    \"aria-label\": \"switching code from redux to recoil permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"When we decided to switch the Hoola AI Page Builder application from redux to Recoil, we knew nothing about it, so when we first read about it intrigued us how it will work in terms of speed and ease of understanding compared to redux.\"), mdx(\"p\", null, \"All the components that used redux were using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"connect\"), \" function to map state and dispatch methods to the component.\"), mdx(\"p\", null, \"State being used here is something similar to this (types are not exact since there is no point to complicate the example):\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"{\\n  elements: { [key: string]: any },\\n  page: {\\n    content: {\\n      id: string;\\n      [key: string]: any;\\n    },\\n    settings: {\\n      general: {\\n        layout: string;\\n      };\\n    }\\n  }\\n  plugins: { [key: string]: any[] };\\n}\"), \"\\n        \"), mdx(\"p\", null, \"So next, let\\u2019s see some code that uses values from redux state:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const Content = ({ rootElement, renderLayout, layout }) => {\\n  const { theme } = usePageBuilder();\\n  const plugins = getPlugins<PbEditorContentPlugin>(\\\"pb-editor-content\\\");\\n\\n  const layouts = React.useMemo(() => {\\n    const plugins = getPlugins<PbPageLayoutPlugin>(\\\"pb-page-layout\\\");\\n    return plugins.map(pl => pl.layout);\\n  }, []);\\n\\n  const themeLayout = layouts.find(l => l.name === layout);\\n\\n  if (renderLayout && !themeLayout) {\\n    return <div>Layout &quot;{layout}&quot; was not found in your theme!</div>;\\n  }\\n\\n  let content = <Element id={rootElement.id} />;\\n\\n  content = renderLayout ? React.createElement(themeLayout.component, null, content) : content;\\n\\n  return (\\n    <div>\\n      {plugins.map(plugin => React.cloneElement(plugin.render(), { key: plugin.name }))}\\n      <div>{content}</div>\\n    </div>\\n  );\\n};\\n\\nconst stateToProps = state => ({\\n  rootElement: state.elements[getContent(state).id],\\n  layout: get(getPage(state), \\\"settings.general.layout\\\"),\\n  renderLayout: isPluginActive(\\\"pb-editor-toolbar-preview\\\")(state),\\n});\\n\\nexport default connect<any, any, any>(stateToProps)(Content);\"), \"\\n        \"), mdx(\"p\", null, \"We did not put some parts of the component since it does not matter in this context. The whole component is located \", mdx(ExternalLink, {\n    href: \"https://github.com/webiny/webiny-js/blob/031f0644c52fa2bd1f7095f0b80818c549d7672d/packages/app-page-builder/src/editor/components/Editor/Content.tsx\",\n    mdxType: \"ExternalLink\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"Redux state structure was transferred to Recoil, with a difference that each of the top-level state properties (page, elements, and plugins) were separated into its own atoms. So we have \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pageAtom\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"elementsAtom\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pluginsAtom\"), \" with the same types as in the redux state.\"), mdx(\"p\", null, \"And that same \", mdx(ExternalLink, {\n    href: \"https://github.com/webiny/webiny-js/blob/812a7ab3725bdb56b9fa0841eb5e8fa05bc0c7a1/packages/app-page-builder/src/editor/components/Editor/Content.tsx\",\n    mdxType: \"ExternalLink\"\n  }, \"component\"), \" with Recoil:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const Content = () => {\\n  const rootElement = useRecoilValue(contentSelector);\\n  const renderLayout = useRecoilValue(isPluginActiveSelector(\\\"pb-editor-toolbar-preview\\\"));\\n  const layout = useRecoilValue(layoutSelector);\\n\\n  const { theme } = usePageBuilder();\\n  const pluginsByType = plugins.byType<PbEditorContentPlugin>(\\\"pb-editor-content\\\");\\n  const layouts = React.useMemo(() => {\\n    const layoutPlugins = plugins.byType<PbPageLayoutPlugin>(\\\"pb-page-layout\\\");\\n    return layoutPlugins.map(pl => pl.layout);\\n  }, []);\\n  const themeLayout = layouts.find(l => l.name === layout);\\n  if (renderLayout && !themeLayout) {\\n    return <div>Layout &quot;{layout}&quot; was not found in your theme!</div>;\\n  }\\n  return (\\n    <div>\\n      {pluginsByType.map(plugin => React.cloneElement(plugin.render(), { key: plugin.name }))}\\n      <div>{renderContent(themeLayout, rootElement, renderLayout)}</div>\\n    </div>\\n  );\\n};\\n\\nexport default Content;\"), \"\\n        \"), mdx(\"p\", null, \"Notice how much simpler this is. Recoil state is being read like plain React\\u2019s state, the difference is just that you pass the atom or selector you want to read instead of the default state value. Also, there is no need to write which type is the variable, e.g., \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rootElement\"), \", since it is extrapolated from an atom or selector that is being used with the hook.\"), mdx(\"p\", null, \"For setting the state, it is simple.\"), mdx(\"p\", null, \"First, let\\u2019s look at one simple component that uses redux:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const Background = ({ element, deactivateElement, highlightElement }) => {\\n  return (\\n    <div\\n      className={backgroundStyle}\\n      onMouseOver={() => highlightElement({ element: null })}\\n      onClick={() => element && deactivateElement()}\\n    />\\n  );\\n};\\n\\nexport default connect<any, any, any>(null, { deactivateElement, highlightElement })(\\n  withActiveElement()(Background),\\n);\"), \"\\n        \"), mdx(\"p\", null, \"Then look at that same component using Recoil (there was some refactoring included, but you get the picture):\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const Background: React.FunctionComponent = () => {\\n  const [uiAtomValue, setUiAtomValue] = useRecoilState(uiAtom);\\n  const { activeElement } = uiAtomValue;\\n\\n  const deactivateElement = useCallback(() => {\\n    if (!activeElement) {\\n      return;\\n    }\\n    setUiAtomValue(prev => ({\\n      ...prev,\\n      activeElement: null,\\n      highlightElement: null,\\n    }));\\n  }, [activeElement]);\\n  return <div className={backgroundStyle} onClick={deactivateElement} />;\\n};\\n\\nexport default React.memo(Background);\"), \"\\n        \"), mdx(\"p\", null, \"As when using React\\u2019s built-in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useState\"), \" hook, you use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useRecoilState\"), \" and set that atom state.\"), mdx(\"h2\", {\n    \"id\": \"creating-selectors\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Creating Selectors\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#creating-selectors\",\n    \"aria-label\": \"creating selectors permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"We will give a few example selectors from Hoola AI Page Builder, first it will be \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"contentSelector\"), \". It is a quite simple piece of code:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"export const contentSelector = selector<PbElement>({\\n  key: \\\"contentSelector\\\",\\n  get: ({ get }) => {\\n    const content = get(contentAtom);\\n    if (content) {\\n      return content;\\n    }\\n\\n    const document = plugins.byName<PbDocumentElementPlugin>(\\\"pb-editor-page-element-document\\\");\\n    invariant(\\n      document,\\n      `\\\"pb-editor-page-element-document\\\" plugin must exist for Page Builder to work!`,\\n    );\\n    return document.create();\\n  },\\n});\"), \"\\n        \"), mdx(\"p\", null, \"So basically it reads \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"contentAtom\"), \", if it is set - it returns that value. Otherwise it creates the document element.\"), mdx(\"p\", null, \"A more complex selector is an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"activeElementWithChildrenSelector\"), \", which uses other selectors to read the state and return some value.\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"export const activeElementWithChildrenSelector = selector<PbElement | undefined>({\\n  key: \\\"activeElementWithChildrenSelector\\\",\\n  get: ({ get }) => {\\n    const id = get(activeElementIdSelector);\\n    if (!id) {\\n      return undefined;\\n    }\\n    return get(elementWithChildrenByIdSelector(id));\\n  },\\n});\"), \"\\n        \"), mdx(\"p\", null, \"Even if it is a more \\u201Ccomplex\\u201D selector, there is nothing complex about it, actually. It is a pure function that reads other selectors and returns an element with its children.\"), mdx(\"h2\", {\n    \"id\": \"creating-selector-families\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Creating Selector Families\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#creating-selector-families\",\n    \"aria-label\": \"creating selector families permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"In Hoola AI we have plugins orientated structure of the code. So basically you can create a plugin, register it and our code will handle running the plugin and doing something with a plugin result if any. So let\\u2019s say that at some point you need to check if some plugin is active. It is quite simple with a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"selectorFamily\"), \":\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"export const isPluginActiveSelector = selectorFamily<boolean, string>({\\n  key: \\\"isPluginActiveSelector\\\",\\n  get: name => {\\n    return ({ get }) => {\\n      const target = plugins.byName(name);\\n      const state = get(pluginsAtom);\\n      if (!target) {\\n        return false;\\n      }\\n      const { type } = target;\\n      if (!state[type]) {\\n        return false;\\n      }\\n      const list = state[type];\\n      return list.some(({ name }) => {\\n        return name === target.name;\\n      });\\n    };\\n  },\\n});\"), \"\\n        \"), mdx(\"p\", null, \"And then you can check if that plugin is active:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const isSomePluginActive = useRecoilValue(isPluginActiveSelector(\\\"plugin-name\\\"));\"), \"\\n        \"), mdx(\"h2\", {\n    \"id\": \"but-recoil-is-missing-something-\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"But Recoil Is Missing Something ...\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#but-recoil-is-missing-something-\",\n    \"aria-label\": \"but recoil is missing something  permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"What Recoil is missing are some kind of built-in actions, like in redux. There is nothing like that out of the box, so you will need to implement it yourself or find some existing library.\"), mdx(\"p\", null, \"In our case, we wrote a small class that handles running the actions when triggered and taking care of the state and any consequent actions that are derived from triggered action. It also has a few types and interfaces to help with writing actual actions and their arguments. You can check the class on our \", mdx(ExternalLink, {\n    href: \"https://github.com/webiny/webiny-js/blob/36cd7e6d23e48e31dac1ad2228cd865ef1838f59/packages/app-page-builder/src/editor/recoil/eventActions/EventActionHandler.ts\",\n    mdxType: \"ExternalLink\"\n  }, \"Github\"), \". By the time you read this, it might change a bit, but overall structure and how it works will most likely stay the same.\"), mdx(\"p\", null, \"Let us explain on usage examples:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"const handler = useEventActionHandler();\\nconst onClickHandler = useCallback(() => {\\n  handler.trigger(\\n    new TogglePluginActionEvent({\\n      name: plugin,\\n      closeOtherInGroup: true,\\n    }),\\n  );\\n}, [plugin]);\"), \"\\n        \"), mdx(\"p\", null, \"Plugin toggle is a simple example of triggering the event which was registered with an event registration plugin. Again, plugin registration is something that has to do internally with our project, but basically, it assigns an action, which is a function of a certain type, to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TogglePluginActionEvent\"), \". The action looks like this:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"export const togglePluginAction: EventActionCallableType<TogglePluginActionArgsType> = (\\n  state,\\n  meta,\\n  args,\\n) => {\\n  const { name, params = {}, closeOtherInGroup = false } = args;\\n  const plugin = plugins.byName(name);\\n  if (!plugin) {\\n    throw new Error(`There is no plugin with name \\\"${name}\\\".`);\\n  }\\n  const { plugins: pluginsAtomValue } = state;\\n  const activePluginsByType = pluginsAtomValue[plugin.type] || [];\\n  const isAlreadyActive = activePluginsByType.some(pl => pl.name === name);\\n\\n  let newPluginsList;\\n  if (isAlreadyActive) {\\n    newPluginsList = activePluginsByType.filter(pl => pl.name !== name);\\n  } else if (closeOtherInGroup) {\\n    newPluginsList = [{ name, params }];\\n  } else {\\n    newPluginsList = activePluginsByType.concat([{ name, params }]);\\n  }\\n\\n  return {\\n    state: {\\n      plugins: {\\n        ...pluginsAtomValue,\\n        [plugin.type]: newPluginsList,\\n      },\\n    },\\n  };\\n};\"), \"\\n        \"), mdx(\"p\", null, \"As you can see, the action changes something in the existing state and returns it for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EventActionHandler\"), \" to write into the atoms.\"), mdx(\"p\", null, \"More complex example of the action is the update element action:\"), mdx(\"deckgo-highlight-code\", {\n    \"language\": \"tsx\"\n  }, \"\\n          \", mdx(\"code\", {\n    parentName: \"deckgo-highlight-code\",\n    \"slot\": \"code\"\n  }, \"export const updateElementAction: EventActionCallableType<UpdateElementActionArgsType> = (\\n  state,\\n  { client },\\n  { element, merge, history = false },\\n) => {\\n  const content = createContentState(state.content, element, merge);\\n  const actions = [];\\n  if (history === true) {\\n    if (!client) {\\n      throw new Error(\\\"You cannot save revision while updating if you do not pass client arg.\\\");\\n    }\\n    actions.push(new SaveRevisionActionEvent());\\n  }\\n  return {\\n    state: {\\n      content,\\n      elements: flattenElementsHelper(content),\\n    },\\n    actions,\\n  };\\n};\"), \"\\n        \"), mdx(\"p\", null, \"This action creates a new content state and, if set to write history, \\u201Cdispatches\\u201D a new action to actually save it to the database. When the handler receives a new state and actions, it keeps running actions it received and only then sets a new state. Action can be async so setting the state will occur after the promise has been awaited, if awaited.\"), mdx(\"p\", null, \"Problems that have arisen were connected to the fact that the Recoil state is accessible only in the tree of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"RecoilRoot\"), \" and sometimes you need to access the state outside of it. When running the action and it starts another action, you want to use an updated state merged with the state that the first action produced, just in case something changed in between the actions. For that issue, there is a small \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/webiny/webiny-js/blob/36cd7e6d23e48e31dac1ad2228cd865ef1838f59/packages/app-page-builder/src/editor/recoil/modules/connected.ts\"\n  }, \"class\"), \" that allows using Recoil state outside of the root, but it's a hack - not officially supported. That class is a derivative of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/lnilya/recoil-connected-store\"\n  }, \"recoil-connected-store\"), \". Since the time we did it this way, an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://recoiljs.org/docs/guides/atom-effects\"\n  }, \"atom effects API\"), \" was released, which should help with this issue. That might be another blog :)\"), mdx(\"h2\", {\n    \"id\": \"and\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"And\\u2026\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#and\",\n    \"aria-label\": \"and permalink\",\n    \"className\": \"heading-link-anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"fill\": \"none\",\n    \"viewBox\": \"0 0 24 24\",\n    \"stroke\": \"currentColor\"\n  }, \"\\n                              \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\",\n    \"strokeWidth\": \"2\",\n    \"d\": \"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\"\n  }), \"\\n                            \"))), mdx(\"p\", null, \"From our perspective it was a good idea to switch to Recoil, although for our case it was not a minor task - there are hundreds of changed or added files.\"), mdx(\"p\", null, \"If you are starting the project from scratch, we would suggest using Recoil, just note that there are differences between it and redux - mainly the hacky state access when not under the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"RecoilRoot\"), \".\"), mdx(\"p\", null, \"This refactored Page Builder will be released with version 5 of Hoola AI this December.\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"author":"bruno","slug":"blog/simplifying-your-application-state-management-with-Recoil","title":"Simplifying your application state management with Recoil","description":"Switching Hoola AI's Page Builder Application state management to Recoil due to redux being hard to maintain and debug.","tags":["Recoil","Redux","Page Builder","JavaScript"],"date":"November 23, 2020","featureImage":{"publicURL":"/static/f0080ae0c93a82d35da2e89cf2245bbd/cover.png","childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACQUlEQVQoz32S7U+SURjGQROYoTI1XlJ8WyMp2djMTdPyDRgIKK+PAb7hFBN94kHBdL3p/Mhq1nK5tWrO9bH6Xv0F1afq//k1jtXW1D5cO/fZzvmd677PpQqFYgSDETrtXTQ2moSara20d1yira0Da0s7Tc0tGE1mhoZdBIMhIbPZgkqlOimvN0AwGGbMP4H9igOjyUIgME6huMH8/ALRaBxJukU6PU8ikeLBwx0ODl4yO5s+Hejx+HC5vHg8Y7jdXhwOJ7GYxMzMHJFIjPHxED6fn7g0Kfbb27s82t6lWNxEq9WeBPb29TNwY4j+gZuipYmJKIqyTjI5xfTMnHAXDkdIpabJrxUolZ5QKj0mm12lqkpzEqjT6bBdtjM4OMLIqAdJSrH3dJ+9Z/vkcnnhNKfkWVsrEApH2bi7xdHRW/FoXZ3htLaPC4ulieERN/F4koXMCvfu77Be2ESWc2Je5Xl6fX66u5309V3H6byG1dp6NrAsvb6Gnp5elPwGz/df8P3HTz5++ows38HvD7C0tIA0GcdsaRIp6LRfRaPRng38o/r6BjJLWb58/ca79x949foNh4eHRKJREskUNlsnDQ1GEa9ynP4LrDMYsLa0MjrqoVjcQskXWFlVyK4qTE2nRSYrz1Whr6nFYKjHZLqI5t/fPi7UarVYXW6vuNzlcLKYyXJ7WWYxsywcl+HLWZnGC0ZUKjUarY7qaj3n9bVnO0xNzYmQl2dZBufXN5FzBaFYPCGCr1ZX/D5/bKKiovKvoV8RPGfSH1FdiwAAAABJRU5ErkJggg==","aspectRatio":1.7699115044247788,"src":"/static/f0080ae0c93a82d35da2e89cf2245bbd/ee604/cover.png","srcSet":"/static/f0080ae0c93a82d35da2e89cf2245bbd/69585/cover.png 200w,\n/static/f0080ae0c93a82d35da2e89cf2245bbd/497c6/cover.png 400w,\n/static/f0080ae0c93a82d35da2e89cf2245bbd/ee604/cover.png 800w,\n/static/f0080ae0c93a82d35da2e89cf2245bbd/f3583/cover.png 1200w,\n/static/f0080ae0c93a82d35da2e89cf2245bbd/5707d/cover.png 1600w,\n/static/f0080ae0c93a82d35da2e89cf2245bbd/eeb1b/cover.png 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"blog/simplifying-your-application-state-management-with-Recoil"}},"staticQueryHashes":["144257237"]}